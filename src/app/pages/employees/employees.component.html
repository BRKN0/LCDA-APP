<router-outlet></router-outlet>


<!-- loading indicator -->
<div *ngIf="loading" class="p-4 text-center text-gray-600">
  <p>Cargando empleados...</p>
</div>

<div *ngIf="!loading">
  <div class="flex justify-end items-center mb-4 mt-4 ml-2">
    <!-- add employee button -->
    <button
      class="btn-add inline-flex items-center space-x-2"
      (click)="addNewEmployee()"
    >
      <svg
        class="w-5 h-5 inline-block align-middle mt-[3px]"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9L11.25 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15L12.75 12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z"
          fill="#ffffff"
        />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z"
          fill="#ffffff"
        />
      </svg>
      <span>Añadir</span>
    </button>
    <button class="btn-clear" (click)="clearFilters()">Limpiar</button>
  </div>
  <!-- search input -->
  <div class="flex items-center justify-center py-4 space-x-4 top-5">
    <div class="relative w-full max-w-md">
      <input
        type="text"
        placeholder="Buscar empleado..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="searchEmployee()"
        class="w-full py-2 px-4 rounded-full border-2 border-red-500 text-gray-700 focus:outline-none focus:border-red-700"
      />
    </div>
  </div>
  <!-- date filters -->
  <div class="flex items-center space-x-4">
    <div>
      <label for="startDate" class="mr-2 font-semibold">Desde:</label>
      <input
        type="date"
        id="startDate"
        [(ngModel)]="startDate"
        (ngModelChange)="searchEmployee()"
        class="border border-gray-300 rounded-md p-1"
      />
    </div>
    <div>
      <label for="endDate" class="mr-2 font-semibold">Hasta:</label>
      <input
        type="date"
        id="endDate"
        [(ngModel)]="endDate"
        (ngModelChange)="searchEmployee()"
        class="border border-gray-300 rounded-md p-1"
      />
    </div>
  </div>
  <table class="table-std">
    <thead>
      <tr>
        <th class="table-column-std">ID del empleado</th>
        <th class="table-column-std">Nombre</th>
        <th class="table-column-std">Numero de documento</th>
        <th class="table-column-std">Email</th>
        <th class="table-column-std">Telefono</th>
        <th class="table-column-std">Salario</th>
        <th class="table-column-std">Fecha de contratacion</th>
        <th class="table-column-std">Tipo de Empleado</th>
        <th class="table-column-std">Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let employee of paginatedEmployees">
        <td>{{ employee.code }}</td>
        <td>{{ employee.name }}</td>
        <td>{{ employee.id_number }}</td>
        <td>{{ employee.email }}</td>
        <td>{{ employee.phone }}</td>
        <td>{{ employee.salary }}</td>
        <td>{{ employee.created_at | date : "dd-MM-yyyy" }}</td>
        <td>
          <select
            class="border rounded p-1"
            [(ngModel)]="employee.employee_type"
            (change)="toggleEmployeeType(employee)"
          >
            <option
              *ngFor="let role of availableEmployeeRoles"
              [value]="role.value"
              [selected]="employee.employee_type === role.value"
            >
              {{ role.label }}
            </option>
          </select>
        </td>
        <td>
          <button class="btn-details" (click)="openDetailsModal(employee)">
            Detalles
          </button>
          <button class="btn-edit" (click)="editEmployee(employee)">
            Editar
          </button>
          <button class="btn-delete" (click)="deleteEmployee(employee)">
            Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- message when no results found -->
  <div *ngIf="noResultsFound" class="p-4 text-center text-gray-600">
    <p>No hay coincidencias con la búsqueda.</p>
  </div>

  <div class="flex justify-between items-center mb-4">
    <!-- pagination controls -->
    <div class="pagination flex items-center">
      <button
        (click)="currentPage = 1; updatePaginatedEmployees()"
        [disabled]="currentPage === 1"
        class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        &#8656;
      </button>
      <button
        (click)="currentPage = currentPage - 1; updatePaginatedEmployees()"
        [disabled]="currentPage === 1"
        class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
      >
        &#8592;
      </button>
      <span class="mx-4 text-gray-700"
        >Página {{ currentPage }} de {{ totalPages }}</span
      >
      <button
        (click)="currentPage = currentPage + 1; updatePaginatedEmployees()"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
      >
        &#8594;
      </button>
      <button
        (click)="currentPage = totalPages; updatePaginatedEmployees()"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        &#8658;
      </button>
    </div>

    <!-- items per page selector -->
    <div class="items-per-page flex items-center">
      <label for="itemsPerPage" class="mr-2">Elementos por página:</label>
      <select
        id="itemsPerPage"
        [(ngModel)]="itemsPerPage"
        (change)="currentPage = 1; updatePaginatedEmployees()"
        class="border border-gray-300 rounded-md p-1"
      >
        <option *ngFor="let size of [2, 10, 15, 20]" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>
  </div>

  <!-- form to add employees -->
  <div *ngIf="showModal" class="modal-overlay">
    <div class="modal-content">
      <h3 class="text-lg font-bold mb-4">
        {{ isEditing ? "Editar Empleado" : "Añadir Nuevo Empleado" }}
      </h3>
      <form (ngSubmit)="saveEmployee()">
        <div class="mb-4">
          <label class="block modal-input-item">Codigo</label>
          <input
            [(ngModel)]="selectedEmployee.code"
            name="code"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">
            Usuario de Sistema (Vincular Cuenta)
            <span class="text-red-500">*</span>
          </label>
          <select
            [ngModel]="selectedEmployee.id_user"
            (change)="onUserSelect($event)"
            name="id_user"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md p-2"
            required
            [disabled]="isEditing"
          >
            <option value="" disabled selected>Seleccione un usuario...</option>
            <option *ngFor="let user of availableUsers" [value]="user.id">
              {{ user.email }} ({{ user.user_name }})
            </option>
          </select>
          <p class="text-xs text-gray-500 mt-1">
            Al seleccionar un usuario, se completará el nombre y correo
            automáticamente.
          </p>
        </div>

        <div class="mb-4">
          <label class="block modal-input-item">
            Nombre Completo <span class="text-red-500">*</span>
          </label>
          <input
            [(ngModel)]="selectedEmployee.name"
            name="name"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div>
          <label class="block modal-input-item"
            >Tipo de Empleado<span class="text-red-500">*</span></label
          >
          <select
            type="text"
            [(ngModel)]="selectedEmployee.employee_type"
            name="employee_type"
            class="form-input mt-1 block w-full"
            required
          >
            <option
              *ngFor="let employee_type of availableEmployeeRoles"
              [value]="employee_type.value"
              [selected]="
                selectedEmployee.employee_type === employee_type.value
              "
            >
              {{ employee_type.label }}
            </option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Numero de identidad</label>
          <input
            [(ngModel)]="selectedEmployee.id_number"
            name="id_number"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Numero de Telefono</label>
          <input
            [(ngModel)]="selectedEmployee.phone"
            name="phone"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Direccion</label>
          <input
            [(ngModel)]="selectedEmployee.address"
            name="address"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Barrio</label>
          <input
            [(ngModel)]="selectedEmployee.neighborhood"
            name="neighborhood"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Ciudad</label>
          <input
            [(ngModel)]="selectedEmployee.city"
            name="city"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Departamento</label>
          <input
            [(ngModel)]="selectedEmployee.department"
            name="department"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Codigo Postal</label>
          <input
            [(ngModel)]="selectedEmployee.postal_code"
            name="postal_code"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block modal-input-item">Salario</label>
          <input
            [(ngModel)]="selectedEmployee.salary"
            name="salary"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="flex justify-end items-center">
          <div>
            <button type="button" class="btn-danger" (click)="closeModal()">
              Cancelar
            </button>
          </div>
          <div>
            <button type="submit" class="btn-success">
              {{ isEditing ? "Actualizar" : "Guardar Empleado" }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <!-- modal for employee details -->
  <div
    *ngIf="showDetailsModal && selectedEmployeeDetails"
    class="modal-overlay"
  >
    <div class="modal-content modal-h300" [class.expanded]="modalExpanded">
      <h3 class="text-lg font-bold mb-4">
        <p><strong>Cliente:</strong> {{ selectedEmployeeDetails.name }}</p>
        <p>
          <strong>Numero de Identificación:</strong
          >{{ selectedEmployeeDetails.id_number }}
        </p>
        <p><strong>Email:</strong> {{ selectedEmployeeDetails.email }}</p>
        <p><strong>Telefono:</strong> {{ selectedEmployeeDetails.phone }}</p>
      </h3>
      <div class="flex space-x-4 mb-4">
        <button
          (click)="toggleLiquidations(selectedEmployeeDetails)"
          class="btn-liquidation"
        >
          Liquidaciones
        </button>
        <button
          (click)="toggleBenefits(selectedEmployeeDetails)"
          class="btn-liquidation"
        >
          Prestaciones
        </button>
        <button class="btn-details" (click)="toggleDetails()">
          {{ showDetails ? "Ocultar Detalles" : "Mostrar Detalles" }}
        </button>
        <button 
        *ngIf="selectedEmployeeDetails.id_user"
        (click)="openPermissionsManagement(selectedEmployeeDetails)" 
        class="bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700 font-medium transition-colors"
      >
        Gestionar Facturas
      </button>
      <span *ngIf="!selectedEmployeeDetails.id_user" class="text-xs text-red-500 content-center">
        (Vincule un usuario para asignar facturas)
      </span>
      </div>

      <!-- employee details -->
      <div *ngIf="showDetails" class="details">
        <p>
          <strong>Tipo de Empleado:</strong>
          {{ getEmployeeTypeLabel(selectedEmployeeDetails.employee_type) }}
        </p>
        <p><strong>Salario:</strong> {{ selectedEmployeeDetails.salary }}</p>
        <p>
          <strong> Direccion: </strong> {{ selectedEmployeeDetails.address }}
        </p>
        <p>
          <strong>Barrio:</strong> {{ selectedEmployeeDetails.neighborhood }}
        </p>
        <p><strong>Ciudad:</strong> {{ selectedEmployeeDetails.city }}</p>
        <p>
          <strong>Departamento:</strong>
          {{ selectedEmployeeDetails.department }}
        </p>
        <p>
          <strong>Codigo Postal:</strong>
          {{ selectedEmployeeDetails.postal_code }}
        </p>
      </div>

      <!-- close button -->
      <div class="flex justify-start mt-4">
        <button class="btn-danger" (click)="closeDetailsModal()">Cerrar</button>
      </div>
    </div>
  </div>
  <!--Liquidations-->
  <div *ngIf="showLiquidations" class="modal-overlay top">
    <div class="modal-content modal-h400 modal-w720">
      <h3 class="text-lg font-bold mb-4">
        Liquidaciones del Empleado: {{ selectedEmployeeDetails?.name }}
      </h3>
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-gray-100">
            <th class="modal-table-column">Detalles</th>
            <th class="modal-table-column">Fecha de Liquidacion</th>
            <th class="modal-table-column">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let l of paginatedLiquidations">
            <td class="modal-table-column">{{ l.notes }}</td>
            <td class="modal-table-column">{{ l.liquidation_date }}</td>
            <td class="modal-table-column">
              <button class="btn-edit" (click)="editLiquidation(l)">
                Editar
              </button>
              <button class="btn-danger" (click)="deleteLiquidation(l)">
                Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="flex justify-between items-center mb-4">
        <div class="pagination flex items-center">
          <button
            (click)="
              currentLiquidationPage = currentLiquidationPage - 1;
              updatePaginatedLiquidations()
            "
            [disabled]="currentLiquidationPage === 1"
            class="px-2 py-1 text-black border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
          >
            ←
          </button>
          <span class="mx-4 text-gray-700">
            Página {{ currentLiquidationPage }} de {{ totalLiquidationPages }}
          </span>
          <button
            (click)="
              currentLiquidationPage = currentLiquidationPage + 1;
              updatePaginatedLiquidations()
            "
            [disabled]="currentLiquidationPage === totalLiquidationPages"
            class="px-2 py-1 text-black border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
          >
            →
          </button>
        </div>
        <div class="items-per-page flex items-center">
          <label for="itemsPerLiquidationPage" class="mr-2">
            Elementos por página:
          </label>
          <select
            id="itemsPerLiquidationPage"
            [(ngModel)]="itemsPerLiquidationPage"
            (change)="updatePaginatedLiquidations()"
            class="border border-gray-300 rounded-md p-1"
          >
            <option *ngFor="let size of [10, 15, 25, 50]" [value]="size">
              {{ size }}
            </option>
          </select>
        </div>
      </div>
      <!-- form to add/edit liquidation -->
      <div
        *ngIf="showAddLiquidation"
        class="mt-4 border rounded-lg p-4 bg-white shadow"
      >
        <h4 class="text-md font-semibold mb-3 text-gray-700">
          {{
            isEditingLiquidation ? "Editar Liquidación" : "Agregar Liquidación"
          }}
        </h4>
        <form (ngSubmit)="saveLiquidation()">
          <div class="mb-2">
            <label>Fecha</label>
            <input
              type="date"
              [(ngModel)]="liquidationForm.liquidation_date"
              name="liquDate"
              class="form-input mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
              required
            />
          </div>
          <div class="mb-2">
            <label>Notas</label>
            <input
              type="text"
              [(ngModel)]="liquidationForm.notes"
              name="liquNotes"
              class="form-input mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
              placeholder="Ej: Fin de contrato"
            />
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button type="submit" class="btn-success">Guardar</button>
            <button
              type="button"
              class="btn-danger"
              (click)="showAddLiquidation = false"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button class="btn-success" (click)="openAddLiquidationForm()">
          Agregar
        </button>
        <button class="btn-danger" (click)="toggleLiquidations(null)">
          Cerrar
        </button>
      </div>
    </div>
  </div>
  <!--Benefits-->
  <div *ngIf="showBenefits" class="modal-overlay top">
    <div class="modal-content top modal-h400 modal-w720">
      <h3 class="text-lg font-bold mb-4">
        Prestaciones del Empleado: {{ selectedEmployeeDetails?.name }}
      </h3>
      <table class="modal-table">
        <thead>
          <tr>
            <th class="modal-table-column">Tipo</th>
            <th class="modal-table-column">Periodo</th>
            <th class="modal-table-column">Estado de Pago</th>
            <th class="modal-table-column">Fecha de pago</th>
            <th class="modal-table-column">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let b of paginatedBenefits">
            <td class="modal-table-column">{{ b.benefit_type }}</td>
            <td class="modal-table-column">{{ b.period }}</td>
            <td class="modal-table-column">{{ b.status }}</td>
            <td class="modal-table-column">{{ b.payment_date }}</td>
            <td class="modal-table-column">
              <button class="btn-edit" (click)="editBenefit(b)">Editar</button>
              <button class="btn-danger" (click)="deleteBenefit(b)">
                Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="flex justify-between items-center mb-4">
        <div class="pagination flex items-center">
          <button
            (click)="
              currentBenefitPage = currentBenefitPage - 1;
              updatePaginatedBenefits()
            "
            [disabled]="currentBenefitPage === 1"
            class="px-2 py-1 text-black border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
          >
            ←
          </button>
          <span class="mx-4 text-gray-700">
            Página {{ currentBenefitPage }} de {{ totalBenefitPages }}
          </span>
          <button
            (click)="
              currentBenefitPage = currentBenefitPage + 1;
              updatePaginatedBenefits()
            "
            [disabled]="currentBenefitPage === totalBenefitPages"
            class="px-2 py-1 text-black border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
          >
            →
          </button>
        </div>
        <div class="items-per-page flex items-center">
          <label for="itemsPerBenefitPage" class="mr-2">
            Elementos por página:
          </label>
          <select
            id="itemsPerBenefitPage"
            [(ngModel)]="itemsPerBenefitPage"
            (change)="updatePaginatedBenefits()"
            class="border border-gray-300 rounded-md p-1"
          >
            <option *ngFor="let size of [10, 15, 25, 50]" [value]="size">
              {{ size }}
            </option>
          </select>
        </div>
      </div>
      <!-- form to add/edit benefit -->
      <div
        *ngIf="showAddBenefit"
        class="mt-4 border rounded-lg p-4 bg-white shadow"
      >
        <h4 class="font-semibold mb-2">
          {{ isEditingBenefit ? "Editar Prestación" : "Agregar Prestación" }}
        </h4>
        <form (ngSubmit)="saveBenefit()">
          <div class="mb-2">
            <label>Tipo</label>
            <input
              type="text"
              [(ngModel)]="benefitForm.benefit_type"
              name="benefitType"
              class="form-input mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
              placeholder="Ej: Prima"
              required
            />
          </div>
          <div class="mb-2">
            <label>Periodo</label>
            <input
              type="text"
              [(ngModel)]="benefitForm.period"
              name="benefitPeriod"
              class="form-input mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
              placeholder="Ej: 2025-06"
              required
            />
          </div>
          <div class="mb-2">
            <label>Valor</label>
            <input
              type="number"
              [(ngModel)]="benefitForm.amount"
              name="benefitAmount"
              class="form-input mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
              placeholder="0"
              required
            />
          </div>
          <div class="mb-2">
            <label>Estado</label>
            <input
              type="text"
              [(ngModel)]="benefitForm.status"
              name="benefitStatus"
              class="form-input mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
              placeholder="Ej: Pagado"
              required
            />
          </div>
          <div class="mb-2">
            <label>Fecha de Pago</label>
            <input
              type="date"
              [(ngModel)]="benefitForm.payment_date"
              name="benefitDate"
              class="form-input mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
            />
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button type="submit" class="btn-success">Guardar</button>
            <button
              type="button"
              class="btn-danger"
              (click)="showAddBenefit = false"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button class="btn-success" (click)="openAddBenefitForm()">
          Agregar
        </button>
        <button class="btn-danger" (click)="toggleBenefits(null)">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
<!-- modal for scheduler invoice permissions -->
<div *ngIf="showPermissionsModal" class="modal-overlay">
  <div class="modal-content w-full max-w-2xl h-auto max-h-[90vh] flex flex-col">
    
    <div class="flex justify-between items-center mb-6 border-b pb-2">
      <div>
        <h3 class="text-xl font-bold text-gray-800">Permisos de Facturas</h3>
        <p class="text-sm text-gray-600">Empleado: <strong>{{ selectedEmployeeDetails?.name }}</strong></p>
      </div>
      <button (click)="closePermissionsModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
    </div>

    <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
      <label class="block text-sm font-bold text-gray-700 mb-2">Dar acceso a nueva factura:</label>
      <div class="relative">
        <div class="flex gap-2">
          <input 
            type="text" 
            [(ngModel)]="invoiceSearchQuery" 
            (keyup.enter)="searchInvoicesToAdd()"
            placeholder="Buscar por código de factura o cliente..." 
            class="form-input flex-1 border border-gray-300 rounded px-3 py-2"
          >
          <button (click)="searchInvoicesToAdd()" class="btn-primary" [disabled]="isSearchingInvoices">
            {{ isSearchingInvoices ? '...' : 'Buscar' }}
          </button>
        </div>

        <div *ngIf="invoiceSearchResults.length > 0" class="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 max-h-48 overflow-y-auto">
          <div 
            *ngFor="let result of invoiceSearchResults" 
            class="p-3 hover:bg-purple-50 cursor-pointer border-b flex justify-between items-center"
            (click)="grantPermission(result)"
          >
            <div>
              <span class="font-bold text-gray-800">#{{ result.code }}</span>
              <span class="text-xs text-gray-500 ml-2">({{ result.client_name }})</span>
            </div>
            <span class="text-xs bg-gray-200 px-2 py-1 rounded">
              {{ formatOrderType(result.order_type, result.secondary_process) }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto">
      <h4 class="font-bold text-gray-700 mb-3">Facturas Asignadas ({{ employeePermissions.length }})</h4>
      
      <div *ngIf="employeePermissions.length === 0" class="text-center py-8 text-gray-400 border-2 border-dashed rounded-lg">
        Este empleado no tiene facturas asignadas manualmente.
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div 
          *ngFor="let perm of employeePermissions" 
          class="relative border border-gray-300 rounded-lg p-3 bg-white shadow-sm hover:shadow-md transition-shadow flex justify-between items-start"
        >
          <div>
            <div class="flex items-center gap-2 mb-1">
              <span class="font-bold text-lg text-gray-800">#{{ perm.code }}</span>
              <span 
                class="text-[10px] uppercase font-bold px-2 py-0.5 rounded-full text-white"
                [ngClass]="{
                  'bg-blue-500': perm.order_type === 'print',
                  'bg-red-500': perm.order_type === 'laser',
                  'bg-green-500': perm.order_type === 'sales'
                }"
              >
                {{ formatOrderType(perm.order_type, perm.secondary_process) }}
              </span>
            </div>
            <p class="text-sm text-gray-600 truncate max-w-[180px]" title="{{ perm.client_name }}">
              <span class="font-semibold">Cliente:</span> {{ perm.client_name }}
            </p>
          </div>

          <button 
            (click)="revokePermission(perm.id_invoice)"
            class="text-gray-400 hover:text-red-600 p-1 rounded-full hover:bg-red-50 transition-colors"
            title="Revocar Acceso"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="flex justify-end mt-4 pt-3 border-t">
      <button class="btn-danger" (click)="closePermissionsModal()">Cerrar</button>
    </div>
  </div>
</div>