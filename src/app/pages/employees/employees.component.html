<app-main-banner></app-main-banner>

<!-- Indicador de carga -->
<div *ngIf="loading" class="p-4 text-center text-gray-600">
  <p>Cargando empleados...</p>
</div>

<div *ngIf="!loading">
  <div class="flex flex-wrap items-center justify-between py-4">
    <div class="relative flex items-center space-x-2">
      <!-- Input de búsqueda -->
      <div class="relative">
        <input
          type="text"
          placeholder="Buscar empleado..."
          [(ngModel)]="searchQuery"
          (ngModelChange)="searchEmployee()"
          class="w-64 py-2 px-4 rounded-full border-2 border-red-500 text-gray-700 focus:outline-none focus:border-red-700"
        />
      </div>
      <!-- filtro fecha -->
      <div class="flex items-center space-x-4">
        <div>
          <label for="startDate" class="mr-2 font-semibold">Desde:</label>
          <input
            type="date"
            id="startDate"
            [(ngModel)]="startDate"
            (ngModelChange)="searchEmployee()"
            class="border border-gray-300 rounded-md p-1"
          />
        </div>
        <div>
          <label for="endDate" class="mr-2 font-semibold">Hasta:</label>
          <input
            type="date"
            id="endDate"
            [(ngModel)]="endDate"
            (ngModelChange)="searchEmployee()"
            class="border border-gray-300 rounded-md p-1"
          />
        </div>
      </div>

      <!-- Botón Añadir empleado -->
      <button
        class="bg-red-500 text-white px-6 py-2 rounded-full hover:bg-red-700"
        (click)="addNewEmployee()"
      >
        Añadir empleado
      </button>
    </div>
  </div>

  <table class="table-std">
    <thead>
      <tr>
        <th class="table-column-std">ID del empleado</th>
        <th class="table-column-std">Nombre</th>
        <th class="table-column-std">Numero de documento</th>
        <th class="table-column-std">Email</th>
        <th class="table-column-std">Telefono</th>
        <th class="table-column-std">Salario</th>
        <th class="table-column-std">Fecha de contratacion</th>
        <th class="table-column-std">Tipo de Empleado</th>
        <th class="table-column-std">Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let employee of paginatedEmployees">
        <td>{{ employee.code }}</td>
        <td>{{ employee.name }}</td>
        <td>{{ employee.id_number }}</td>
        <td>{{ employee.email }}</td>
        <td>{{ employee.phone }}</td>
        <td>{{ employee.employee_type }}</td>
        <td>{{ employee.salary }}</td>
        <td>{{ employee.created_at | date : "dd-MM-yyyy" }}</td>
        <td>
          <button class="btn-edit" (click)="editEmployee(employee)">
            Editar
          </button>
          <button class="btn-delete" (click)="deleteEmployee(employee)">
            Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Mensaje de no resultados para búsqueda por nombre -->
  <div *ngIf="noResultsFound" class="p-4 text-center text-gray-600">
    <p>No hay coincidencias con la búsqueda.</p>
  </div>

  <div class="flex justify-between items-center mb-4">
    <!-- Controles de paginación -->
    <div class="pagination flex items-center">
      <button
        (click)="currentPage = currentPage - 1; updatePaginatedEmployees()"
        [disabled]="currentPage === 1"
        class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        &#8592;
      </button>
      <span class="mx-4 text-gray-700"
        >Página {{ currentPage }} de {{ totalPages }}</span
      >
      <button
        (click)="currentPage = currentPage + 1; updatePaginatedEmployees()"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        &#8594;
      </button>
    </div>

    <!-- Selector de elementos por página -->
    <div class="items-per-page flex items-center">
      <label for="itemsPerPage" class="mr-2">Elementos por página:</label>
      <select
        id="itemsPerPage"
        [(ngModel)]="itemsPerPage"
        (change)="currentPage = 1; updatePaginatedEmployees()"
        class="border border-gray-300 rounded-md p-1"
      >
        <option *ngFor="let size of [2, 10, 15, 20]" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>
  </div>

  <!-- Form to add clients -->
  <div
    *ngIf="showModal"
    class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center"
  >
    <div class="bg-white w-[500px] max-w-[90vw] rounded-lg shadow-lg p-6 max-h-[90vh] overflow-y-auto">
      <h3 class="text-lg font-bold mb-4">
        {{ isEditing ? "Editar Empleado" : "Añadir Nuevo Empleado" }}
      </h3>
      <form (ngSubmit)="saveEmployee()">
        <div class="mb-4">
          <label class="block text-gray-700">Codigo</label>
          <input
            [(ngModel)]="selectedEmployee.code"
            name="code"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Nombre Completo</label>
          <input
            [(ngModel)]="selectedEmployee.name"
            name="name"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Numero de identidad</label>
          <input
            [(ngModel)]="selectedEmployee.id_number"
            name="id_number"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Correo Electrónico</label>
          <input
            type="email"
            [(ngModel)]="selectedEmployee.email"
            name="email"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Numero de Telefono</label>
          <input
            [(ngModel)]="selectedEmployee.phone"
            name="phone"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Direccion</label>
          <input
            [(ngModel)]="selectedEmployee.address"
            name="address"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Barrio</label>
          <input
            [(ngModel)]="selectedEmployee.neighborhood"
            name="neighborhood"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Ciudad</label>
          <input
            [(ngModel)]="selectedEmployee.city"
            name="city"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Departamento</label>
          <input
            [(ngModel)]="selectedEmployee.department"
            name="department"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Codigo Postal</label>
          <input
            [(ngModel)]="selectedEmployee.postal_code"
            name="postal_code"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Salario</label>
          <input
            [(ngModel)]="selectedEmployee.salary"
            name="salary"
            class="form-input mt-1 block w-full border border-gray-300 rounded-md"
            required
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Tipo de empleado</label>
          <select
            [(ngModel)]="selectedEmployee.employee_type"
            name="type_employee"
            class="form-select mt-1 block w-full"
            required
          >
            <option value="printer">Impresiones</option>
            <option value="cutter">Corte laser</option>
            <option value="counter">Contador</option>
            <option value="seller">Vendedor</option>
            <option value="scheduled">Agendador</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button type="button" class="btn-danger" (click)="closeModal()">
            Cancelar
          </button>
          <button type="submit" class="btn-success">
            {{ isEditing ? "Actualizar" : "Guardar Empleado" }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
