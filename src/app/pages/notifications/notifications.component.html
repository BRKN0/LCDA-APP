<router-outlet></router-outlet>

<!-- Indicador de carga -->
<div *ngIf="loading" class="p-8 text-center text-gray-500">
  <div class="animate-pulse">Cargando notificaciones...</div>
</div>

<div
  *ngIf="!loading"
  class="notifications-container space-y-6 p-4 max-w-4xl mx-auto"
>
  <div
    *ngIf="userRole === 'admin' && lowStock.length > 0"
    class="notification-section"
  >
    <h2
      class="section-title text-orange-600 font-bold mb-3 flex items-center gap-2"
    >
      ⚠️ Bajo Stock
      <span class="text-xs bg-orange-100 px-2 py-0.5 rounded-full">{{
        lowStock.length
      }}</span>
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div
        *ngFor="let n of lowStock"
        class="p-3 bg-orange-50 border border-orange-200 rounded-lg text-sm text-orange-800"
      >
        {{ getUpdatedDescription(n.description) }}
      </div>
    </div>
  </div>

  <div
    *ngIf="userRole === 'scheduler' && processNotifications.length > 0"
    class="notification-section"
  >
    <h2 class="section-title text-blue-700 font-bold mb-3">
      Procesos Secundarios Completados
    </h2>
    <div class="space-y-2">
      <div
        *ngFor="let n of processNotifications"
        class="p-3 bg-blue-50 border border-blue-100 rounded-lg flex justify-between items-center"
      >
        <span class="text-sm font-medium text-blue-900">{{
          n.description
        }}</span>
        <button
          (click)="deleteNotification(n)"
          class="text-blue-400 hover:text-blue-600"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m4.5 12.75 6 6 9-13.5"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div
    *ngIf="userRole === 'admin' && allFinanceNotifications.length > 0"
    class="notification-section"
  >
    <h2 class="section-title text-red-600 font-bold mb-3">
      Finanzas y Vencimientos
    </h2>
    <div class="space-y-2">
      <div
        *ngFor="let n of allFinanceNotifications"
        class="p-3 bg-red-50 border border-red-100 rounded-lg flex justify-between items-center group"
      >
        <div>
          <p class="text-sm font-semibold text-red-900">{{ n.description }}
            <span *ngIf="n.id_expenses && expensesCodeMap[n.id_expenses]">
              #{{ expensesCodeMap[n.id_expenses] }}
            </span>
          </p>
          <p
            class="text-[10px] text-red-500 uppercase tracking-wider font-bold"
          >
            Vence: {{ n.due_date | date : "dd/MM/yyyy" }}
          </p>
        </div>
        <button
          (click)="deleteNotification(n)"
          class="text-red-300 hover:text-red-600"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="userRole === 'admin'" class="notification-section">
    <div class="flex justify-between items-center mb-4 border-b pb-2">
      <h2 class="font-bold text-gray-700">Recordatorios</h2>
      <button
        (click)="toggleReminderForm()"
        class="text-xs bg-indigo-600 text-white px-4 py-1.5 rounded-lg hover:bg-indigo-700 shadow-sm transition-all"
      >
        + Nuevo
      </button>
    </div>
    <div class="space-y-2">
      <div
        *ngFor="let n of reminders"
        class="p-3 bg-white border rounded-xl flex justify-between items-center hover:shadow-md transition-all"
      >
        <div>
          <p class="text-sm text-gray-800 font-medium">{{ n.description }}</p>
          <p class="text-[10px] text-gray-400">
            Plazo: {{ n.due_date | date : "dd/MM/yyyy" }}
          </p>
        </div>
        <div class="flex gap-1">
          <button
            (click)="selectNotification(n)"
            class="p-2 text-indigo-500 hover:bg-indigo-50 rounded-full"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"
              />
            </svg>
          </button>
          <button
            (click)="deleteNotification(n)"
            class="p-2 text-gray-300 hover:text-red-500 rounded-full"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
    <div
    *ngIf="userRole === 'cuts_employee' || userRole === 'prints_employee' || userRole === 'admin'"
    class="notification-section"
  >
    <h2 class="section-title font-bold text-gray-800 mb-4 border-b pb-2">
      Nuevos Pedidos
    </h2>
    <div class="space-y-3">
      <div
        *ngFor="let n of orderNotifications"
        class="relative p-4 bg-white border rounded-xl shadow-sm group"
      >
        <p class="text-gray-900 font-medium pr-10">{{ n.description }}</p>
        <p class="text-[10px] text-gray-400 mt-1">
          Fecha entrega: {{ n.due_date | date : "dd/MM/yyyy" }}
        </p>
        <button
          (click)="deleteNotification(n)"
          class="absolute top-4 right-4 text-gray-300 hover:text-red-500 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<div
  *ngIf="showAddReminderForm"
  class="modal-overlay fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4"
>
  <div
    class="modal-content modal-h300 bg-white p-6 rounded-2xl shadow-xl w-full max-w-md"
  >
    <h3 class="text-xl font-bold mb-4">Nuevo Recordatorio</h3>
    <form (ngSubmit)="generateReminder(reminderForm)">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700"
            >Descripción</label
          >
          <input
            [(ngModel)]="reminderForm.description"
            name="description"
            class="w-full border rounded-lg p-2 mt-1 focus:ring-2 focus:ring-indigo-500"
            required
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Fecha</label>
          <input
            type="date"
            [(ngModel)]="reminderForm.due_date"
            name="due_date"
            class="w-full border rounded-lg p-2 mt-1"
            required
          />
        </div>
      </div>
      <div class="flex justify-end gap-3 mt-6">
        <button
          type="button"
          (click)="closeModals()"
          class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
        >
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<div
  *ngIf="showEditReminderForm && selectedNotification"
  class="modal-overlay fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4"
>
  <div
    class="modal-content modal-h300 bg-white p-6 rounded-2xl shadow-xl w-full max-w-md"
  >
    <h3 class="text-xl font-bold mb-4">Editar Recordatorio</h3>
    <form (ngSubmit)="editReminder(selectedNotification)">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700"
            >Descripción</label
          >
          <input
            [(ngModel)]="selectedNotification.description"
            name="edit_description"
            class="w-full border rounded-lg p-2 mt-1 focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Fecha</label>
          <input
            type="date"
            [(ngModel)]="selectedNotification.due_date"
            name="edit_due_date"
            class="w-full border rounded-lg p-2 mt-1"
          />
        </div>
      </div>
      <div class="flex justify-end gap-3 mt-6">
        <button
          type="button"
          (click)="closeModals()"
          class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          Actualizar
        </button>
      </div>
    </form>
  </div>
</div>
