<router-outlet></router-outlet>


<!-- Botón para añadir nuevo -->
<div class="flex justify-end mb-4 mt-4 ml-2">
  <button
    class="btn-add inline-flex items-center space-x-2"
    (click)="addVinylCut()"
  >
    <svg
      class="w-5 h-5 inline-block align-middle mt-[3px]"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9L11.25 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15L12.75 12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z"
        fill="#ffffff"
      />
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z"
        fill="#ffffff"
      />
    </svg>
    <span>Añadir</span>
  </button>
  <button
      class="btn-clear "
      (click)="clearFilters()"
    >
      Limpiar
  </button>
</div>
<!-- Filtros de búsqueda -->
<div class="flex justify-start items-center mb-4 mt-4 ml-2">
  <div class="flex space-x-2">
    <label class="font-semibold">Filtrar por tipo:</label>
    <select
      [(ngModel)]="searchType"
      (change)="updateFilteredVinylCuts()"
      class="border border-gray-300 rounded-md p-1 h-8"
    >
      <option value="">-- Todos --</option>
      <option *ngFor="let type of availableTypes" [value]="type">
        {{ type }}
      </option>
    </select>
    <label class="font-semibold">Buscar proveedor:</label>
    <input
      type="text"
      [(ngModel)]="searchSupplier"
      (input)="updateFilteredVinylCuts()"
      class="border p-2 rounded h-8"
    />
  </div>
</div>
<!-- Tabla con paginación -->
<div *ngIf="!loading && filteredVinylCuts.length > 0">
  <table class="table-std">
    <thead>
      <tr>
        <th class="table-column-std">Proveedor</th>
        <th class="table-column-std">Tipo</th>
        <th class="table-column-std">Unds/Mts</th>
        <th class="table-column-std">Descripción</th>
        <th class="table-column-std">Costo x Mt</th>
        <th class="table-column-std">Venta x Mt</th>
        <th class="table-column-std">Cm Lineal</th>
        <th class="table-column-std">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of paginatedVinylCuts">
        <td>{{ item.supplier }}</td>
        <td>{{ item.type }}</td>
        <td>{{ item.unds_mts }}</td>
        <td>{{ item.description }}</td>
        <td>{{ item.costXmt | currency : "COP" }}</td>
        <td>{{ item.saleXmt | currency : "COP" }}</td>
        <td>{{ item.linearCm | currency : "COP" }}</td>
        <td>
          <button
            class="btn-edit"
            (click)="editVinylCut(item); $event.stopPropagation()"
            style="text-decoration: none"
          >
            Editar
          </button>
          <button
            class="btn-delete"
            (click)="deleteVinylCut(item); $event.stopPropagation()"
            style="text-decoration: none"
          >
            Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="flex justify-between items-center mb-4">
    <!-- Controles de paginación -->
    <div class="pagination flex items-center">
      <button
        (click)="currentPage = 1; updatePaginatedVinylCuts()"
        [disabled]="currentPage === 1"
        class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        &#8656;
      </button>
      <button
        (click)="currentPage = currentPage - 1; updatePaginatedVinylCuts()"
        [disabled]="currentPage === 1"
        class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
      >
        &#8592;
      </button>
      <span class="mx-4 text-gray-700">
        Página {{ currentPage }} de {{ totalPages }}
      </span>
      <button
        (click)="currentPage = currentPage + 1; updatePaginatedVinylCuts()"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
      >
        &#8594;
      </button>
      <button
        (click)="currentPage = totalPages; updatePaginatedVinylCuts()"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        &#8658;
      </button>
    </div>

    <!-- Selector de elementos por página -->
    <div class="items-per-page flex items-center">
      <label for="itemsPerPage" class="mr-2">Elementos por página:</label>
      <select
        id="itemsPerPage"
        [(ngModel)]="itemsPerPage"
        (change)="currentPage = 1; updatePaginatedVinylCuts()"
        class="border border-gray-300 rounded-md p-1"
      >
        <option *ngFor="let size of [5, 10, 15, 20]" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>
  </div>
</div>
<div
  *ngIf="!loading && filteredVinylCuts.length === 0"
  class="text-center mt-8 text-gray-600"
>
  No se encontraron registros.
</div>

<!-- Formulario modal -->
<div *ngIf="showModal" class="modal-overlay">
  <div class="modal-content">
    <h3 class="text-lg font-bold mb-4">
      {{ isEditing ? "Editar Vinilo de Corte" : "Nuevo Vinilo de Corte" }}
    </h3>
    <form (ngSubmit)="saveVinylCut()">
      <div class="mb-4">
        <label class="block modal-input-item"
          >Proveedor<span class="text-red-500">*</span></label
        >
        <input
          type="text"
          [(ngModel)]="selectedVinylCut.supplier"
          name="supplier"
          class="form-input mt-1 block w-full"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item"
          >Unds/Mts<span class="text-red-500">*</span></label
        >
        <input
          type="number"
          [(ngModel)]="selectedVinylCut.unds_mts"
          name="unds_mts"
          class="form-input mt-1 block w-full"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item"
          >Tipo<span class="text-red-500">*</span></label
        >
        <input
          type="text"
          [(ngModel)]="selectedVinylCut.type"
          name="type"
          class="form-input mt-1 block w-full"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item"
          >Descripción<span class="text-red-500">*</span></label
        >
        <input
          type="text"
          [(ngModel)]="selectedVinylCut.description"
          name="description"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item"
          >Costo x metro<span class="text-red-500">*</span></label
        >
        <input
          type="number"
          [(ngModel)]="selectedVinylCut.costXmt"
          name="costXmt"
          class="form-input mt-1 block w-full"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item"
          >Precio venta x metro<span class="text-red-500">*</span></label
        >
        <input
          type="number"
          [(ngModel)]="selectedVinylCut.saleXmt"
          name="saleXmt"
          class="form-input mt-1 block w-full"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Precio lineal x cm</label>
        <input
          type="number"
          [value]="round(selectedVinylCut.saleXmt / 100)"
          disabled
          class="form-input mt-1 block w-full bg-gray-100"
        />
      </div>
      <div class="flex justify-end mt-6">
        <button type="button" class="btn-danger" (click)="closeModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-success">
          {{ isEditing ? "Actualizar" : "Guardar" }}
        </button>
      </div>
    </form>
  </div>
</div>
