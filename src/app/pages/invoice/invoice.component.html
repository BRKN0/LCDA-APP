<router-outlet></router-outlet>
<app-main-banner></app-main-banner>

<!-- Filtros y búsqueda -->
<div class="flex justify-between items-center mb-4 mt-4 ml-2">
  <div class="flex space-x-2">
    <label>
      <input
        type="checkbox"
        [(ngModel)]="showPrints"
        class="form-checkbox"
        (change)="updateFilteredInvoices()"
      />
      <span class="ml-2">Impresiones</span>
    </label>
    <label>
      <input
        type="checkbox"
        [(ngModel)]="showCuts"
        class="form-checkbox"
        (change)="updateFilteredInvoices()"
      />
      <span class="ml-2">Cortes</span>
    </label>
    <label>
      <input
        type="checkbox"
        [(ngModel)]="showSales"
        class="form-checkbox"
        (change)="updateFilteredInvoices()"
      />
      <span class="ml-2">Ventas</span>
    </label>
    <label>
      <input
        type="checkbox"
        [(ngModel)]="showDebt"
        class="form-checkbox"
        (change)="updateFilteredInvoices()"
      />
      <span class="ml-2">En Mora</span>
    </label>
  </div>

  <div class="flex space-x-2">
    <!-- Botón Añadir Factura, pegado a la derecha -->
    <button
      class="btn-add inline-flex items-center space-x-2"
      (click)="addNewInvoice()"
    >
      <svg
        class="w-5 h-5 inline-block align-middle mt-[3px]"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9L11.25 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15L12.75 12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z"
          fill="#ffffff"
        />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z"
          fill="#ffffff"
        />
      </svg>
      <span>Añadir</span>
    </button>
    <button class="btn-clear" (click)="clearFilters()">Limpiar</button>
  </div>
</div>

<div class="flex items-center justify-center mt-2">
  <div class="w-full max-w-md relative">
    <input
      type="text"
      placeholder="Ingrese nombre o empresa"
      [(ngModel)]="nameSearchQuery"
      (input)="updateFilteredInvoices()"
      class="w-full py-2 px-4 rounded-full border-2 border-red-500 text-gray-700 focus:outline-none focus:border-red-700"
    />
  </div>
</div>
<!-- Filter date range y botón Añadir Factura, pegado a la derecha y alineado -->
<div class="mb-2 mt-2 ml-2">
  <div class="flex items-center space-x-4">
    <div>
      <label for="startDate" class="mr-2 font-semibold">Desde:</label>
      <input
        type="date"
        id="startDate"
        [(ngModel)]="startDate"
        (ngModelChange)="updateFilteredInvoices()"
        class="form-input"
      />
    </div>
    <div>
      <label for="endDate" class="mr-2 font-semibold">Hasta:</label>
      <input
        type="date"
        id="endDate"
        [(ngModel)]="endDate"
        (ngModelChange)="updateFilteredInvoices()"
        class="form-input"
      />
    </div>
  </div>
</div>
<!-- Invoice Table -->
<div class="mt-4">
  <table class="table-std">
    <thead>
      <tr>
        <th class="table-column-std">N° Factura</th>
        <th class="table-column-std">Tipo</th>
        <th class="table-column-std">Cliente</th>
        <th class="table-column-std">Fecha</th>
        <th class="table-column-std">Abonos</th>
        <th class="table-column-std">Falta por pagar</th>
        <th class="table-column-std">Estado</th>
        <th class="table-column-std">Plazo de Pago</th>
        <th class="table-column-std">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let invoice of paginatedInvoice">
        <td class="table-column-std">{{ invoice.code }}</td>
        <td class="table-column-std">
          {{
            invoice.order.order_type === "print"
              ? "Impresiones"
              : invoice.order.order_type === "laser"
              ? "Cortes"
              : invoice.order.order_type === "sales"
              ? "Ventas"
              : "Otro"
          }}
        </td>
        <td class="table-column-std">
          {{
            invoice.order.client.company_name === "N/A"
              ? invoice.order.client.name
              : invoice.order.client.company_name || invoice.order.client.name
          }}
        </td>
        <td class="table-column-std">
          {{ invoice.created_at | date : "dd-MM-yyyy" }}
        </td>
        <td class="table-column-std">${{ getTotalPayments(invoice.order) }}</td>
        <td class="table-column-std">
          ${{ formatNumber(getRemainingBalance(invoice)) }}
        </td>
        <td
          class="table-column-std"
          [class.text-green-600]="invoice.invoice_status === 'upToDate'"
          [class.text-red-600]="invoice.invoice_status === 'overdue'"
        >
          {{
            invoice.invoice_status === "overdue"
              ? "En Mora"
              : invoice.invoice_status === "upToDate"
              ? "Al Día"
              : "Desconocido"
          }}
        </td>
        <td class="table-column-std">
          {{ getRemainingPaymentTerm(invoice) }}
        </td>
        <td class="table-column-std">
          <button class="btn-details" (click)="selectInvoice(invoice)">
            Detalles
          </button>
          <!-- Botón Editar -->
          <button class="btn-edit" (click)="editInvoice(invoice)">
            Editar
          </button>
          <!-- Botón Eliminar -->
          <button class="btn-delete" (click)="deleteInvoice(invoice)">
            Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- No results found -->
  <div *ngIf="noResultsFound" class="p-4 text-center text-gray-600">
    <p>No hay coincidencias con la búsqueda.</p>
  </div>

  <div class="flex justify-between items-center mb-4">
    <!-- Controles de paginación -->
    <div class="pagination flex items-center">
      <button
        (click)="currentPage = 1; updatePaginatedInvoices()"
        [disabled]="currentPage === 1"
        class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        ⇐
      </button>
      <button
        (click)="currentPage = currentPage - 1; updatePaginatedInvoices()"
        [disabled]="currentPage === 1"
        class="btn-primary flex items-center justify-center px-2 py-1 rounded-full disabled:bg-gray-300 disabled:cursor-not-allowed w-7 h-7"
      >
        ←
      </button>
      <span class="mx-4 text-gray-700"
        >Página {{ currentPage }} de {{ totalPages }}</span
      >
      <button
        (click)="currentPage = currentPage + 1; updatePaginatedInvoices()"
        [disabled]="currentPage === totalPages"
        class="btn-primary flex items-center justify-center px-2 py-1 rounded-full disabled:bg-gray-300 disabled:cursor-not-allowed w-7 h-7"
      >
        →
      </button>
      <button
        (click)="currentPage = totalPages; updatePaginatedInvoices()"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
      >
        ⇒
      </button>
    </div>

    <!-- Selector de elementos por página -->
    <div class="items-per-page flex items-center">
      <label for="itemsPerPage" class="mr-2">Elementos por página:</label>
      <select
        id="itemsPerPage"
        [(ngModel)]="itemsPerPage"
        (change)="currentPage = 1; updatePaginatedInvoices()"
        class="form-select"
      >
        <option *ngFor="let size of [2, 10, 15, 20]" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>
  </div>
</div>

<!-- Modal para añadir/editar facturas -->
<div *ngIf="showModal" class="modal-overlay">
  <div class="modal-content modal-h550">
    <h3 class="text-lg font-bold mb-4">
      {{ isEditing ? "Editar Factura" : "Añadir Factura" }}
    </h3>
    <form (ngSubmit)="saveInvoice()">
      <!-- Campo de selección de cliente -->
      <div class="mb-4">
        <label class="block text-gray-700"
          >Cliente<span class="text-red-500">*</span></label
        >
        <div class="relative">
          <input
            type="text"
            placeholder="Buscar cliente por nombre..."
            [(ngModel)]="clientSearchQuery"
            (ngModelChange)="searchClients()"
            name="clientSearch"
            class="form-input"
            (focus)="showClientDropdown = true"
            (blur)="hideClientDropdown()"
            required
          />
          <div
            *ngIf="showClientDropdown && filteredClients.length > 0"
            class="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-40 overflow-y-auto"
          >
            <div
              class="p-2 bg-gray-200 hover:bg-gray-100 cursor-pointer"
              (click)="openAddClientModal()"
            >
              <strong>Añadir un Cliente Nuevo</strong>
            </div>
            <div
              *ngFor="let client of filteredClients"
              class="p-2 hover:bg-gray-200 cursor-pointer"
              (click)="selectClient(client)"
            >
              {{ client.name }} ({{ client.company_name || "Sin empresa" }})
            </div>
          </div>
        </div>
      </div>

      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block text-gray-700">Tipo</label>
        <select
          [(ngModel)]="selectedInvoice.order.order_type"
          name="type"
          class="form-select"
          [disabled]="isEditing"
          required
        >
          <option value="print">Impresiones</option>
          <option value="laser">Cortes</option>
          <option value="sales">Ventas</option>
        </select>
      </div>
      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block text-gray-700"
          >Clasificación tributaria (para impuestos)<span class="text-red-500"
            >*</span
          ></label
        >
        <select
          [(ngModel)]="selectedInvoice.classification"
          name="classification"
          class="form-select"
          required
        >
          <option value="BIEN">Bien</option>
          <option value="SERVICIO">Servicio</option>
        </select>
      </div>
      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block modal-input-item">{{ ivaLabel() }}</label>
        <input
          type="checkbox"
          [(ngModel)]="selectedInvoice.include_iva"
          (change)="onIncludeIvaChange()"
          name="includeIva"
          class="form-checkbox mt-1"
          [checked]="selectedInvoice.include_iva || false"
        />
      </div>
      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block text-gray-700">Plazo de Pago (días)</label>
        <input
          type="number"
          [(ngModel)]="selectedInvoice.payment_term"
          name="paymentTerm"
          class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          placeholder="Ej. 15"
          [readonly]="isEditing"
        />
      </div>
      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block text-gray-700">Valor Total</label>
        <input
          type="number"
          [(ngModel)]="selectedInvoice.order.total"
          (change)="onTotalChange($event)"
          name="total"
          class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          placeholder="Ej. 14000"
          required
        />
      </div>
      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block text-gray-700">Total</label>
        <input
          type="number"
          [(ngModel)]="selectedInvoice.order.total"
          name="total"
          class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          readonly
        />
      </div>
      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block text-gray-700">Estado</label>
        <select
          [(ngModel)]="selectedInvoice.invoice_status"
          name="status"
          class="form-select"
          required
        >
          <option value="upToDate">Al Día</option>
          <option value="overdue">En Mora</option>
        </select>
      </div>
      <div class="mb-4" *ngIf="selectedInvoice">
        <label class="block text-gray-700"
          >Orden<span class="text-red-500">*</span></label
        >
        <select
          [(ngModel)]="selectedInvoice.order.id_order"
          name="id_order"
          class="form-select"
          required
        >
          <option value="" disabled selected>Seleccione una orden</option>
          <option *ngFor="let order of clientOrders" [value]="order.id_order">
            {{ order.description || order.order_type }}
          </option>
        </select>
        <p *ngIf="clientOrders.length === 0" class="text-red-500 mt-2">
          No hay órdenes disponibles para este cliente de este tipo.
        </p>
      </div>

      <div class="flex justify-end">
        <button type="button" class="btn-danger" (click)="closeModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-success px-4 py-2 rounded-md">
          {{ isEditing ? "Actualizar Factura" : "Guardar Factura" }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal para añadir cliente -->
<div *ngIf="showAddClientModal" class="modal-overlay">
  <div class="modal-content w-1/2">
    <h2 class="text-xl font-bold mb-4">Añadir Nuevo Cliente</h2>
    <form (ngSubmit)="saveNewClient()">
      <div class="mb-4">
        <label class="block text-gray-700">Nombre</label>
        <input
          [(ngModel)]="newClient.name"
          name="name"
          class="form-input"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Correo Electrónico</label>
        <input
          type="email"
          [(ngModel)]="newClient.email"
          name="email"
          class="form-input"
        />
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Tipo de Documento</label>
        <select
          [(ngModel)]="newClient.document_type"
          name="document_type"
          class="form-select"
        >
          <option value="NIT">NIT</option>
          <option value="civil registry">Registro civil</option>
          <option value="identity card">Tarjeta de identidad</option>
          <option value="citizenship card">Cédula de ciudadanía</option>
          <option value="alien card">Tarjeta de extranjería</option>
          <option value="foreigner's identity card">
            Cédula de extranjería
          </option>
          <option value="passport">Pasaporte</option>
          <option value="foreign identification document">
            Documento de identificación extranjero
          </option>
          <option value="NIT from another country">NIT de otro país</option>
          <option value="NUIP">NUIP</option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Identificación/Documento</label>
        <input
          [(ngModel)]="newClient.document_number"
          name="document_number"
          class="form-input"
        />
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Empresa</label>
        <input
          [(ngModel)]="newClient.company_name"
          name="company_name"
          class="form-input"
        />
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Teléfono</label>
        <input
          type="number"
          [(ngModel)]="newClient.cellphone"
          name="cellphone"
          class="form-input"
        />
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Dirección</label>
        <input
          type="text"
          [(ngModel)]="newClient.address"
          name="address"
          class="form-input"
        />
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Estado</label>
        <select
          [(ngModel)]="newClient.status"
          name="status"
          class="form-select mt-1 block w-full"
        >
          <option value="upToDate">Al Día</option>
          <option value="overdue">En Mora</option>
        </select>
      </div>
      <div class="flex justify-end">
        <button
          type="button"
          class="btn-danger"
          (click)="closeAddClientModal()"
        >
          Cancelar
        </button>
        <button type="submit" class="btn-success px-4 py-2 rounded-md">
          Guardar Cliente
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Show details of the selected invoice in float window -->
<div
  *ngIf="selectedInvoiceDetails && selectedInvoiceDetails.length > 0"
  class="modal-overlay"
>
  <div class="modal-content modal-h750">
    <!-- Notificación -->
    <div
      *ngIf="notificationMessage"
      class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4"
    >
      {{ notificationMessage }}
    </div>
    <h2 class="text-xl font-bold">Detalles de Factura</h2>

    <!-- Printable Invoice Layout -->
    <div class="p-4 border border-gray-300 bg-white invoice-details">
      <div class="flex justify-between mb-4">
        <div>
          <h3 class="font-semibold text-lg">
            Factura N°: {{ selectedInvoiceDetails[0].code }}
          </h3>
          <p>
            <strong>Fecha:</strong>
            {{ selectedInvoiceDetails[0].created_at | date : "dd-MM-yyyy" }}
          </p>
          <p
            [class.text-green-600]="
              selectedInvoiceDetails[0].invoice_status === 'upToDate'
            "
            [class.text-red-600]="
              selectedInvoiceDetails[0].invoice_status === 'overdue'
            "
          >
            <strong>Estado:</strong>
            {{
              selectedInvoiceDetails[0].invoice_status === "overdue"
                ? "En Mora"
                : selectedInvoiceDetails[0].invoice_status === "upToDate"
                ? "Al Día"
                : "Desconocido"
            }}
          </p>
          <p>
            <strong>Plazo de Pago:</strong>
            {{ getRemainingPaymentTerm(selectedInvoiceDetails[0]) }}
          </p>
        </div>
        <div class="text-right">
          <p>
            <strong>De:</strong>
            {{
              selectedInvoiceDetails[0].order.client.company_name ||
                selectedInvoiceDetails[0].order.client.name
            }}
          </p>
          <p>{{ selectedInvoiceDetails[0].order.client.address }}</p>
          <p>
            {{ selectedInvoiceDetails[0].order.client.city }},
            {{ selectedInvoiceDetails[0].order.client.province }}
            {{ selectedInvoiceDetails[0].order.client.postal_code }}
          </p>
          <p>{{ selectedInvoiceDetails[0].order.client.email }}</p>
          <p>{{ selectedInvoiceDetails[0].order.client.cellphone }}</p>
        </div>
      </div>

      <!-- Itemized Invoice List -->
      <div class="my-6">
        <h4 class="font-semibold"></h4>
        <ul class="list-none">
          <li>
            <p>
              <strong>Descripción:</strong>
              {{ selectedInvoiceDetails[0].order.description }}
            </p>
            <p>
              <strong>Cantidad:</strong>
              {{ selectedInvoiceDetails[0].order.order_quantity }}
            </p>
            <p>
              <strong>Valor Unitario:</strong>
              {{ selectedInvoiceDetails[0].order.unitary_value }}
            </p>
          </li>
        </ul>
      </div>

      <!-- Totals Section -->
      <div
        class="border-t pt-4 mt-4 space-y-4"
        *ngIf="selectedInvoiceDetails.length && calculatedValues as valores"
      >
        <!-- Subtotal e IVA -->
        <div class="space-y-2">
          <div class="flex justify-between">
            <p><strong>Subtotal base:</strong></p>
            <p>
              {{ valores.subtotal | currency : "COP" }}
            </p>
          </div>

          <div
            class="flex justify-between"
            *ngIf="selectedInvoiceDetails[0].include_iva"
          >
            <p>
              <strong>{{ ivaLabel() }}:</strong>
            </p>
            <p>{{ valores.iva | currency : "COP" }}</p>
          </div>
        </div>

        <!-- RETEFUENTE -->
        <div class="flex justify-between">
          <p>
            <strong>{{ retefuenteLabel(selectedInvoiceDetails[0]) }}:</strong>
          </p>
          <p>
            {{
              valores.retefuente > 0
                ? (-valores.retefuente | number : "1.2-2")
                : "No aplica"
            }}
          </p>
        </div>

        <!-- RETEICA -->
        <div class="flex justify-between">
          <p>
            <strong>{{ retefuenteLabel(selectedInvoiceDetails[0]) }}:</strong>
          </p>
          <p>
            {{
              valores.retefuente > 0
                ? (-valores.retefuente | number : "1.2-2")
                : "No aplica"
            }}
          </p>
        </div>
        <div
          class="flex justify-between"
          *ngIf="selectedInvoiceDetails[0].include_iva"
        >
        </div>
        <!-- Totales -->
        <div class="border-t pt-4 space-y-2">
          <div class="flex justify-between">
            <p><strong>Total a Facturar:</strong></p>
            <p class="font-bold text-green-600">
              {{ valores.total | number : "1.2-2" }}
            </p>
          </div>

          <div class="flex justify-between">
            <p><strong>Abonos Realizados:</strong></p>
            <p>
              {{
                getTotalPayments(selectedInvoiceDetails[0].order)
                  | currency : "COP"
              }}
            </p>
          </div>

          <div class="flex justify-between">
            <p><strong>Falta por Pagar:</strong></p>
            <p class="text-red-600 font-semibold">
              {{
                getRemainingBalance(selectedInvoiceDetails[0])
                  | currency : "COP"
              }}
            </p>
          </div>
        </div>

        <!-- Lista de abonos -->
        <div
          *ngIf="
            selectedInvoiceDetails[0].order.payments &&
            selectedInvoiceDetails[0].order.payments.length > 0
          "
          class="mt-4"
        >
          <h4 class="font-semibold">Abonos:</h4>
          <ul>
            <li
              *ngFor="let payment of selectedInvoiceDetails[0].order.payments"
            >
              ${{ payment.amount }} - {{ payment.payment_method }} -
              {{ payment.payment_date | date : "dd-MM-yyyy" }}
              <button class="text-blue-500 ml-2" (click)="editPayment(payment)">
                Editar
              </button>
              <button
                class="text-blue-500 ml-2"
                (click)="
                  deletePayment(payment, selectedInvoiceDetails[0].order)
                "
              >
                Eliminar
              </button>
            </li>
          </ul>
        </div>

        <!-- Formulario para añadir abono -->
        <div class="mt-4">
          <h4 class="font-semibold">Añadir Abono:</h4>
          <div class="mb-4">
            <label class="block text-gray-700">Monto del abono</label>
            <input
              type="number"
              placeholder="Monto del abono"
              [(ngModel)]="newPaymentAmount"
              name="newPaymentAmount"
              class="form-input w-full mt-1"
            />
          </div>
          <div class="mb-4">
            <label class="block text-gray-700">Método de pago</label>
            <select
              [(ngModel)]="newPaymentMethod"
              name="newPaymentMethod"
              class="form-select w-full mt-1"
            >
              <option value="" disabled selected>Seleccione un método</option>
              <option value="Efectivo">Efectivo</option>
              <option value="Nequi">Nequi</option>
              <option value="Bancolombia">Bancolombia</option>
              <option value="Davivienda">Davivienda</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
          <div class="flex justify-end mt-4">
            <button
              type="button"
              class="btn-danger justify-start py-2 px-4 mr-2 mt-2 rounded"
              (click)="closeModal()"
            >
              Cancelar
            </button>
            <button
              class="btn-success justify-start py-2 px-4 mr-2 mt-2 rounded"
              (click)="
                addPayment(
                  selectedInvoiceDetails[0].order,
                  newPaymentAmount,
                  newPaymentMethod
                )
              "
            >
              Añadir Abono
            </button>
            <!-- Botón para descargar PDF -->
            <button
              type="button"
              class="btn-success justify-between py-2 px-4 mr-2 mt-2 rounded"
              (click)="generatePdf()"
            >
              Descargar Recibo de venta
            </button>
            <button
              type="button"
              class="btn-success justify-between py-2 px-4 mr-2 mt-2 rounded"
              (click)="downloadQuotePDF()"
            >
              Descargar Cuenta de Cobro
            </button>
            <button
              type="button"
              class="btn-success justify-between py-2 px-4 mr-2 mt-2 rounded"
              (click)="downloadDeliveryNotePDF()"
            >
              Descargar Remisión
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para editar abono -->
    <div *ngIf="showEditPayment && selectedPayment" class="modal-overlay">
      <div class="modal-content w-1/3">
        <h4 class="text-lg font-bold mb-4">Editar Abono</h4>
        <div class="mb-4">
          <label class="block text-gray-700">Monto</label>
          <input
            type="number"
            [(ngModel)]="selectedPayment.amount"
            name="editPaymentAmount"
            class="form-input w-full mt-1"
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Método de pago</label>
          <select
            [(ngModel)]="selectedPayment.payment_method"
            name="editPaymentMethod"
            class="form-select w-full mt-1"
          >
            <option value="Efectivo">Efectivo</option>
            <option value="Nequi">Nequi</option>
            <option value="Bancolombia">Bancolombia</option>
            <option value="Davivienda">Davivienda</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button class="btn-danger" (click)="showEditPayment = false">
            Cancelar
          </button>
          <button
            class="btn-success px-4 py-2 rounded-md ml-2"
            (click)="updatePayment(selectedInvoiceDetails[0].order)"
          >
            Guardar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
