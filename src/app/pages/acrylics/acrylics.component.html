<router-outlet></router-outlet>
<app-main-banner></app-main-banner>

<!-- Indicador de carga -->
<div *ngIf="loading" class="p-4 text-center text-gray-600">
  <p>Cargando inventario...</p>
</div>

<!-- Selección de formato y botón de acción -->
<div *ngIf="!loading" class="flex items-center space-x-4 mb-4">
  <label for="format" class="font-semibold">Formato:</label>
  <select
    id="format"
    [(ngModel)]="selectedFormat"
    class="border border-gray-300 rounded-md p-1"
  >
    <option value="1 Lámina">1 Lámina</option>
    <option value="1/2 (Media Lámina)">1/2 (Media Lámina)</option>
    <option value="1/3 (Tercio de Lámina)">1/3 (Tercio de Lámina)</option>
    <option value="1/4 (Cuarto de Lámina)">1/4 (Cuarto de Lámina)</option>
    <option value="1/8 (Octavo de Lámina)">1/8 (Octavo de Lámina)</option>
    <option value="1/16 (Dieciseisavo de Lámina)">1/16 (Dieciseisavo de Lámina)</option>
    <option value="1/32 (Treintaydosavo de Lámina)">1/32 (Treintaydosavo de Lámina)</option>
  </select>

  <!-- Barra de búsqueda -->
  <input
    type="text"
    [(ngModel)]="searchTerm"
    (input)="onSearchChange()"
    placeholder="Buscar por ancho, alto, color o calibre..."
    class="border border-gray-300 rounded-md p-1 w-64"
  />

  <!-- Botón para añadir acrílico -->
  <button
    class="bg-red-500 text-white px-6 py-2 rounded-full hover:bg-red-700"
    (click)="openModal()"
  >
    Añadir Acrílico
  </button>
</div>

<!-- Tabla de acrílico -->
<div *ngIf="!loading">
  <div *ngIf="paginatedAcrylicItems.length > 0">
    <div class="table-container">
      <table class="table-std">
        <thead>
          <tr>
            <th class="table-column-std">Ancho</th>
            <th class="table-column-std">Alto</th>
            <th class="table-column-std">Color</th>
            <th class="table-column-std">Calibre</th>
            <th class="table-column-std">Costo</th>
            <th class="table-column-std">30% Util.</th>
            <th class="table-column-std">Margen</th>
            <th class="table-column-std">+Margen</th>
            <th class="table-column-std">Sin IVA</th>
            <th class="table-column-std">IVA</th>
            <th class="table-column-std">Con IVA</th>
            <th class="table-column-std">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let acrylic of paginatedAcrylicItems">
            <td class="table-column-std">{{ acrylic.width }}</td>
            <td class="table-column-std">{{ acrylic.height }}</td>
            <td class="table-column-std">{{ acrylic.color }}</td>
            <td class="table-column-std">{{ acrylic.gauge }}</td>
            <td class="table-column-std">${{ acrylic.cost_price.toLocaleString() }}</td>
            <td class="table-column-std">${{ calculateBasePriceWith30PercentProfit(acrylic.cost_price).toLocaleString() }}</td>
            <td class="table-column-std">{{ (getAppliedMargin() * 100).toFixed(0) }}%</td>
            <td class="table-column-std">${{ calculateAdjustedPriceWith30PercentProfit(acrylic.cost_price).toLocaleString() }}</td>
            <td class="table-column-std">${{ calculatePriceWithMargin(calculateAdjustedPriceWith30PercentProfit(acrylic.cost_price)).toLocaleString() }}</td>
            <td class="table-column-std">${{ calculateIva(calculateFinalPriceWithoutIva(calculatePriceWithMargin(calculateAdjustedPriceWith30PercentProfit(acrylic.cost_price)))).toLocaleString() }}</td>
            <td class="table-column-std">${{ calculatePriceWithIva(calculateFinalPriceWithoutIva(calculatePriceWithMargin(calculateAdjustedPriceWith30PercentProfit(acrylic.cost_price))), calculateIva(calculateFinalPriceWithoutIva(calculatePriceWithMargin(calculateAdjustedPriceWith30PercentProfit(acrylic.cost_price))))).toLocaleString() }}</td>
            <td class="table-column-std">
              <button class="btn-edit" (click)="openModal(acrylic)">Editar</button>
              <button class="btn-delete" (click)="deleteAcrylic(acrylic.id_acrylics)">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Controles de paginación -->
    <div class="flex justify-between items-center mb-4">
      <div class="pagination flex items-center">
        <button
          (click)="currentPage = 1; updatePaginatedAcrylicItems()"
          [disabled]="currentPage === 1"
          class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
        >
          &#8656;
        </button>
        <button
          (click)="currentPage = currentPage - 1; updatePaginatedAcrylicItems()"
          [disabled]="currentPage === 1"
          class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
        >
          ←
        </button>
        <span class="mx-4 text-gray-700">
          Página {{ currentPage }} de {{ totalPages }}
        </span>
        <button
          (click)="currentPage = currentPage + 1; updatePaginatedAcrylicItems()"
          [disabled]="currentPage === totalPages"
          class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
        >
          →
        </button>
        <button
          (click)="currentPage = totalPages; updatePaginatedAcrylicItems()"
          [disabled]="currentPage === totalPages"
          class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
        >
          &#8658;
        </button>
      </div>

      <!-- Selector de elementos por página -->
      <div class="items-per-page flex items-center">
        <label for="itemsPerPage" class="mr-2">Elementos por página:</label>
        <select
          id="itemsPerPage"
          [(ngModel)]="itemsPerPage"
          (change)="currentPage = 1; updatePaginatedAcrylicItems()"
          class="border border-gray-300 rounded-md p-1"
        >
          <option *ngFor="let size of [2, 10, 15, 20]" [ngValue]="size">
            {{ size }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay datos -->
  <div *ngIf="paginatedAcrylicItems.length === 0" class="p-4 text-center text-gray-600">
    <p>No hay datos disponibles para Acrílicos.</p>
  </div>
</div>

<!-- Modal para crear/editar acrílico -->
<div
  *ngIf="showModal"
  class="modal-overlay"
>
<!-- class="bg-white w-[500px] max-w-[90vw] rounded-lg shadow-lg p-6 max-h-[90vh] overflow-y-auto" -->
<div class="modal-content"
  
  >
    <h3 class="text-lg font-bold mb-4">
      {{ selectedAcrylic ? 'Editar Acrílico' : 'Añadir Nuevo Acrílico' }}
    </h3>
    <form (ngSubmit)="saveAcrylic()">
      <div class="mb-4">
        <label class="block modal-input-item">Ancho (cm)</label>
        <input
          type="number"
          [(ngModel)]="formAcrylic.width"
          name="width"
          class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          placeholder="Ej. 120"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Alto (cm)</label>
        <input
          type="number"
          [(ngModel)]="formAcrylic.height"
          name="height"
          class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          placeholder="Ej. 90"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Color</label>
        <select
          [(ngModel)]="formAcrylic.color"
          name="color"
          class="form-select mt-1 block w-full border border-gray-300 rounded-md"
          required
        >
          <option value="Cristal y Opal">Cristal y Opal</option>
          <option value="Color Rojo">Color Rojo</option>
          <option value="Humo">Humo</option>
          <option value="Espejo">Espejo</option>
          <option value="Metalizados">Metalizados</option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Calibre (mm)</label>
        <input
          type="number"
          step="0.1"
          [(ngModel)]="formAcrylic.gauge"
          name="gauge"
          class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          placeholder="Ej. 1.5"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Precio Costo Lámina 2025</label>
        <input
          type="number"
          [(ngModel)]="formAcrylic.cost_price"
          name="cost_price"
          class="form-input mt-1 block w-full border border-gray-300 rounded-md"
          placeholder="Ej. 171200"
          required
        />
      </div>
      <div class="flex justify-end">
        <button type="button" class="btn-danger" (click)="closeModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-success justify-start">
          {{ selectedAcrylic ? 'Actualizar' : 'Guardar Acrílico' }}
        </button>
      </div>
    </form>
  </div>
</div>
