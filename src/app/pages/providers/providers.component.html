<router-outlet></router-outlet>
<app-main-banner></app-main-banner>

<!-- Loading -->
<div *ngIf="loading" class="p-4 text-center text-gray-600">
  <p>Cargando datos de proveedores...</p>
</div>

<!-- Action buttons -->
<div *ngIf="!loading" class="flex justify-end space-x-2 mr-4 mb-4 mt-4">
  <button
    class="btn-add inline-flex items-center space-x-2"
    (click)="addProvider()"
  >
    <svg
      class="w-5 h-5 inline-block align-middle mt-[3px]"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9V11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15V12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z"
        fill="#ffffff"
      />
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z"
        fill="#ffffff"
      />
    </svg>
    <span>Añadir</span>
  </button>

  <button class="btn-details" (click)="importFromExcel()">
    Importar desde Excel
  </button>
  <button class="btn-details" (click)="exportToExcel()">
    Exportar a Excel
  </button>
</div>
<div class="flex items-center justify-center mt-2">
  <div class="w-full max-w-md relative">
    <input
      type="text"
      placeholder="Ingrese nombre o empresa"
      [(ngModel)]="nameSearchQuery"
      (input)="updateFilteredProviders()"
      class="w-full py-2 px-4 rounded-full border-2 border-red-500 text-gray-700 focus:outline-none focus:border-red-700"
    />
  </div>
</div>
<!-- add/edit modal -->
<div *ngIf="showModal && selectedProvider" class="modal-overlay">
  <div class="modal-content modal-h800 overflow-y-auto">
    <h3 class="text-lg font-bold mb-4">
      {{ isEditing ? "Editar Proveedor" : "Nuevo Proveedor" }}
    </h3>
    <form (ngSubmit)="saveProvider()">
      <div class="mb-4">
        <label class="block modal-input-item"
          >Nombre de Empresa<span class="text-red-500">*</span></label
        >
        <input
          type="text"
          [(ngModel)]="selectedProvider.company_name"
          name="company_name"
          required
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item"
          >Nombre Contacto<span class="text-red-500">*</span></label
        >
        <input
          type="text"
          [(ngModel)]="selectedProvider.name"
          name="name"
          required
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Apellido Contacto</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.last_name"
          name="last_name"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Tipo de Documento</label>
        <select
          [(ngModel)]="selectedProvider.document_type"
          name="document_type"
          class="form-select mt-1 block w-full"
        >
          <option *ngFor="let docType of document_types" [value]="docType">
            {{ docType }}
          </option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Número de Documento</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.document_number"
          name="document_number"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Tipo de Proveedor</label>
        <select
          [(ngModel)]="selectedProvider.provider_type"
          name="provider_type"
          class="form-select mt-1 block w-full"
        >
          <option *ngFor="let type of provider_types" [value]="type">
            {{ type }}
          </option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Régimen</label>
        <select
          [(ngModel)]="selectedProvider.regimen"
          name="regimen"
          class="form-select mt-1 block w-full"
        >
          <option *ngFor="let regime of provider_regimen" [value]="regime">
            {{ regime }}
          </option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Responsabilidad</label>
        <select
          [(ngModel)]="selectedProvider.responsibility"
          name="responsibility"
          class="form-select mt-1 block w-full"
        >
          <option *ngFor="let resp of provider_responsibilities" [value]="resp">
            {{ resp }}
          </option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Declaraciones</label>
        <select
          [(ngModel)]="selectedProvider.declares"
          name="declares"
          class="form-select mt-1 block w-full"
        >
          <option *ngFor="let dec of provider_declarations" [value]="dec">
            {{ dec }}
          </option>
        </select>
      </div>

      <!-- Sección Contacto -->
      <div class="mb-4">
        <label class="block modal-input-item">Correo Electrónico</label>
        <input
          type="email"
          [(ngModel)]="selectedProvider.email"
          name="email"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Teléfono</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.phone_number"
          name="phone_number"
          class="form-input mt-1 block w-full"
        />
      </div>

      <!-- Sección Ubicación -->
      <div class="mb-4">
        <label class="block modal-input-item">Dirección 1</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.address1"
          name="address1"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Dirección 2</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.address2"
          name="address2"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Barrio</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.neighborhood"
          name="neighborhood"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Ciudad</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.city"
          name="city"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Departamento</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.department"
          name="department"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">Código Postal</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.postal_code"
          name="postal_code"
          class="form-input mt-1 block w-full"
        />
      </div>
      <div class="mb-4">
        <label class="block modal-input-item">País</label>
        <input
          type="text"
          [(ngModel)]="selectedProvider.country"
          name="country"
          class="form-input mt-1 block w-full"
        />
      </div>

      <!-- Sección Comentario -->
      <div class="mb-4">
        <label class="block modal-input-item">Comentario</label>
        <textarea
          [(ngModel)]="selectedProvider.comment"
          name="comment"
          class="form-input mt-1 block w-full"
        ></textarea>
      </div>

      <!-- Botones -->
      <div class="flex justify-end mt-4">
        <button type="button" class="btn-danger mr-2" (click)="closeModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-success">
          {{ isEditing ? "Actualizar" : "Guardar" }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Tabla de proveedores -->
<div *ngIf="!loading">
  <div *ngIf="paginatedProviders.length > 0">
    <table class="table-std">
      <thead>
        <tr>
          <th class="table-column-std">Nombre de Empresa</th>
          <th class="table-column-std">Nombre Contacto</th>
          <th class="table-column-std">Correo</th>
          <th class="table-column-std">Teléfono</th>
          <th class="table-column-std">Tipo</th>
          <th class="table-column-std">Documento</th>
          <th class="table-column-std">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let provider of paginatedProviders">
          <td>{{ provider.company_name }}</td>
          <td>{{ provider.name }} {{ provider.last_name }}</td>
          <td>{{ provider.email }}</td>
          <td>{{ provider.phone_number }}</td>
          <td>{{ provider.provider_type }}</td>
          <td>{{ provider.document_type }} {{ provider.document_number }}</td>
          <td>
            <button class="btn-details" (click)="viewProviderDetails(provider)">
              Detalles
            </button>
            <button class="btn-edit" (click)="editProvider(provider)">
              Editar
            </button>
            <button class="btn-delete" (click)="deleteProvider(provider)">
              Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="flex justify-between items-center mb-4 mt-4">
      <div class="pagination flex items-center">
        <button
          (click)="currentPage = 1; updatePaginatedProviders()"
          [disabled]="currentPage === 1"
          class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
        >
          &#8656;
        </button>
        <button
          (click)="currentPage = currentPage - 1; updatePaginatedProviders()"
          [disabled]="currentPage === 1"
          class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
        >
          &#8592;
        </button>
        <span class="mx-4 text-gray-700"
          >Página {{ currentPage }} de {{ totalPages }}</span
        >
        <button
          (click)="currentPage = currentPage + 1; updatePaginatedProviders()"
          [disabled]="currentPage === totalPages"
          class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
        >
          &#8594;
        </button>
        <button
          (click)="currentPage = totalPages; updatePaginatedProviders()"
          [disabled]="currentPage === totalPages"
          class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
        >
          &#8658;
        </button>
      </div>

      <div class="items-per-page flex items-center">
        <label for="itemsPerPage" class="mr-2">Elementos por página:</label>
        <select
          id="itemsPerPage"
          [(ngModel)]="itemsPerPage"
          (change)="currentPage = 1; updatePaginatedProviders()"
          class="border border-gray-300 rounded-md p-1"
        >
          <option *ngFor="let size of [5, 10, 15, 20]" [value]="size">
            {{ size }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <div
    *ngIf="paginatedProviders.length === 0"
    class="p-4 text-center text-gray-600"
  >
    <p>No hay resultados para la búsqueda o filtros aplicados.</p>
  </div>
</div>
<!-- Details Modal -->
<div *ngIf="selectedProviderDetails" class="modal-overlay">
  <div class="modal-content modal-h800 overflow-y-auto">
    <h2 class="text-xl font-bold mb-4">Detalles del Proveedor</h2>

    <div class="p-4 border border-gray-300 bg-white invoice-details space-y-4">
      <div>
        <h3 class="font-semibold text-lg/7 mb-2">Identificación</h3>
        <p>
          <strong>Tipo de Documento:</strong>
          {{ selectedProviderDetails.document_type }}
        </p>
        <p>
          <strong>Número de Documento:</strong>
          {{ selectedProviderDetails.document_number }}
        </p>
        <p>
          <strong>Tipo de Proveedor:</strong>
          {{ selectedProviderDetails.provider_type }}
        </p>
        <p><strong>Régimen:</strong> {{ selectedProviderDetails.regimen }}</p>
        <p>
          <strong>Responsabilidad:</strong>
          {{ selectedProviderDetails.responsibility }}
        </p>
        <p>
          <strong>Declaraciones:</strong> {{ selectedProviderDetails.declares }}
        </p>
      </div>

      <div>
        <h3 class="font-semibold text-lg/9 mb-2">Contacto</h3>
        <p>
          <strong>Empresa:</strong> {{ selectedProviderDetails.company_name }}
        </p>
        <p>
          <strong>Nombre:</strong> {{ selectedProviderDetails.name }}
          {{ selectedProviderDetails.last_name }}
        </p>
        <p><strong>Email:</strong> {{ selectedProviderDetails.email }}</p>
        <p>
          <strong>Teléfono:</strong> {{ selectedProviderDetails.phone_number }}
        </p>
      </div>

      <div>
        <h3 class="font-semibold text-lg/9 mb-2">Ubicación</h3>
        <p>
          <strong>Dirección 1:</strong> {{ selectedProviderDetails.address1 }}
        </p>
        <p>
          <strong>Dirección 2:</strong> {{ selectedProviderDetails.address2 }}
        </p>
        <p>
          <strong>Barrio:</strong> {{ selectedProviderDetails.neighborhood }}
        </p>
        <p><strong>Ciudad:</strong> {{ selectedProviderDetails.city }}</p>
        <p>
          <strong>Departamento:</strong>
          {{ selectedProviderDetails.department }}
        </p>
        <p>
          <strong>Código Postal:</strong>
          {{ selectedProviderDetails.postal_code }}
        </p>
        <p><strong>País:</strong> {{ selectedProviderDetails.country }}</p>
      </div>

      <div>
        <h3 class="font-semibold text-lg/9 mb-2">Comentario</h3>
        <p>{{ selectedProviderDetails.comment }}</p>
      </div>

      <div class="flex justify-end mt-4">
        <button
          type="button"
          class="btn-danger mr-2"
          (click)="closeProviderDetails()"
        >
          Cerrar
        </button>
        
      </div>
    </div>
  </div>
</div>
