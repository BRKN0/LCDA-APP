<router-outlet></router-outlet>


<div *ngIf="loading" class="p-4 text-center text-gray-600">
  <p>Cargando egresos...</p>
</div>
<div class="flex justify-between items-center mb-4 mt-4 ml-2">
  <div class="flex flex-wrap gap-4 items-end mt-4 mb-4">
    <!-- Categoría -->
    <div>
      <label class="block text-sm font-semibold">Categoría</label>
      <select
        [(ngModel)]="filterCategory"
        (change)="onFilterCategoryChange()"
        class="form-select w-48"
      >
        <option value="">Todas</option>
        <option *ngFor="let c of getFilterCategories()" [value]="c">
          {{ getCategoryLabel(c) }}
        </option>
      </select>
    </div>

    <!-- Tipo de servicio -->
    <div *ngIf="filterCategory === 'UTILITIES'">
      <label class="block text-sm font-semibold">Tipo de servicio</label>
      <select
        [(ngModel)]="filterServiceType"
        (change)="applyFilters()"
        class="form-select w-48"
      >
        <option value="">Todos</option>
        <option *ngFor="let s of getFilterServiceTypes()" [value]="s">
          {{ s }}
        </option>
      </select>
    </div>

    <!-- Proveedor -->
    <div>
      <label class="block text-sm font-semibold">Proveedor</label>
      <select
        [(ngModel)]="filterProviderId"
        (change)="applyFilters()"
        class="form-select w-56"
      >
        <option value="">Todos</option>
        <option *ngFor="let prov of providersList" [value]="prov.id_provider">
          {{ prov.company_name || prov.name }}
        </option>
      </select>
    </div>

    <!-- Solo pendientes -->
    <div class="flex items-center gap-2 mt-6">
      <input
        type="checkbox"
        [(ngModel)]="onlyPending"
        (change)="applyFilters()"
        class="form-checkbox h-4 w-4 text-red-600"
      />
      <span class="text-sm font-semibold">Solo pendientes</span>
    </div>
  </div>
  <div class="flex space-x-2">
    <button
      class="btn-add inline-flex items-center space-x-2"
      (click)="addNewExpense()"
    >
      <svg
        class="w-5 h-5 inline-block"
        viewBox="0 0 24 24"
        fill="none"
        stroke="white"
        stroke-width="2"
      >
        <path d="M12 5v14M5 12h14" />
      </svg>
      <span>Añadir</span>
    </button>
    <button class="btn-details" (click)="generateExpensesKardex()">
      Generar Kardex
    </button>
    <button class="btn-clear" (click)="clearFilters()">Limpiar</button>
  </div>
</div>
<div class="flex items-center space-x-4">
  <div>
    <label for="startDate" class="mr-2 font-semibold">Desde:</label>
    <input
      type="date"
      id="startDate"
      [(ngModel)]="startDate"
      (ngModelChange)="applyFilters()"
      class="border border-gray-300 rounded-md p-1"
    />
  </div>
  <div>
    <label for="endDate" class="mr-2 font-semibold">Hasta:</label>
    <input
      type="date"
      id="endDate"
      [(ngModel)]="endDate"
      (ngModelChange)="applyFilters()"
      class="border border-gray-300 rounded-md p-1"
    />
  </div>
</div>

<!-- Resumen de Egresos -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-3 mb-3">

  <!-- Total Pagado -->
  <div class="bg-green-50 border border-green-200 rounded-lg p-1">
    <p class="text-xs font-semibold text-green-700">
      Total Salida
    </p>
    <p class="text-lg font-mono font-bold text-green-900 mt-1">
      {{ totalPaid | currency }}
    </p>
    <p class="text-[11px] text-green-700 mt-1">
      Dinero que ya salió de la empresa
    </p>
  </div>

  <!-- Total Pendiente -->
  <div class="bg-red-50 border border-red-200 rounded-lg p-1">
    <p class="text-xs font-semibold text-red-700">
      Total Pendiente
    </p>
    <p class="text-lg font-mono font-bold text-red-900 mt-1">
      {{ totalPending | currency }}
    </p>
    <p class="text-[11px] text-red-700 mt-1">
      Compromisos de pago por cubrir
    </p>
  </div>

  <!-- Total General -->
  <div class="bg-gray-100 border border-gray-300 rounded-lg p-1">
    <p class="text-xs font-semibold text-gray-700">
      Total Egresos
    </p>
    <p class="text-lg font-mono font-bold text-gray-900 mt-1">
      {{ totalExpenses | currency }}
    </p>
    <p class="text-[11px] text-gray-600 mt-1">
      Pagado + Pendiente según filtros
    </p>
  </div>

</div>

<!-- Tabla -->
<div class="mt-4 overflow-x-auto">
  <table class="table-std w-full">
    <thead>
      <tr>
        <th class="table-column-std">Fecha</th>
        <th class="table-column-std">Categoría</th>
        <th class="table-column-std">Proveedor</th>
        <th class="table-column-std">Anotación</th>
        <th class="table-column-std">Costo</th>
        <th class="table-column-std">Tipo Pago</th>
        <th class="table-column-std">Estado</th>
        <th class="table-column-std">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let expense of paginatedExpenses" class="hover:bg-gray-50">
        <td class="px-4 py-2 border-b">
          {{ expense.payment_date | date : "dd-MM-yyyy" }}
        </td>

        <td class="px-4 py-2 border-b">
          {{
            expense.category === "UTILITIES" && expense.service_type
              ? getCategoryLabel(expense.category) +
                " - " +
                expense.service_type
              : getCategoryLabel(expense.category)
          }}
        </td>
        <td class="px-4 py-2 border-b text-sm text-gray-600">
          {{ expense.provider_name || "NO APLICA" }}
        </td>
        <td class="px-4 py-2 border-b">{{ expense.description }}</td>
        <td class="px-4 py-2 border-b text-right font-mono">
          {{ expense.cost | currency }}
        </td>
        <td class="px-4 py-2 border-b">
          {{ 
            expense.type === 'cash' ? 'Efectivo' :
            expense.type === 'nequi' ? 'Nequi' :
            expense.type === 'bancolombia' ? 'Bancolombia' :
            expense.type === 'davivienda' ? 'Davivienda' :
            expense.type === 'transfer' ? 'Transferencia'
            : 'Ninguno' 
          }}
        </td>
        <td class="px-4 py-2 border-b text-center">
          <div class="flex items-center justify-start gap-2">
            <input
              type="checkbox"
              [checked]="expense.payment_status === 'PAID'"
              (change)="toggleExpenseStatus(expense)"
              class="w-4 h-4 text-green-600 rounded border-gray-300 cursor-pointer focus:ring-green-500"
            />
            <span
              class="text-xs font-bold"
              [ngClass]="{
                'text-green-600': expense.payment_status === 'PAID',
                'text-red-500': expense.payment_status === 'PENDING'
              }"
            >
              {{ expense.payment_status === "PAID" ? "Pagado" : "Pendiente" }}
            </span>
          </div>
          <div
            *ngIf="
              expense.payment_status === 'PENDING' && expense.payment_due_date
            "
            class="text-xs text-red-400 mt-1 text-left"
          >
            Vence: {{ expense.payment_due_date | date : "dd-MM-yyyy" }}
          </div>
        </td>

        <td class="px-4 py-2 border-b">
          <div class="flex gap-2">
            <button
              class="btn-details inline-flex items-center space-x-2 px-2 py-1 text-xs"
              (click)="viewExpenseDetails(expense)"
              title="Ver Detalles y Adjuntos"
            >
              <span>Detalles</span>
            </button>
            <button
              class="btn-edit text-xs px-2 py-1"
              (click)="editExpense(expense)"
            >
              Editar
            </button>
            <button
              class="btn-delete text-xs px-2 py-1"
              [disabled]="deletingExpenseId === expense.id_expenses"
              (click)="deleteExpense(expense) ; $event.stopPropagation()"
            >
               {{ deletingExpenseId === expense.id_expenses ? 'Eliminando...' : 'Eliminar' }}
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="flex justify-between items-center mb-4">
  <!-- Controles de paginación -->
  <div class="pagination flex items-center">
    <button
      (click)="currentPage = 1; updatePaginatedExpenses()"
      [disabled]="currentPage === 1"
      class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
    >
      &#8656;
    </button>
    <button
      (click)="currentPage = currentPage - 1; updatePaginatedExpenses()"
      [disabled]="currentPage === 1"
      class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
    >
      ←
    </button>
    <span class="mx-4 text-gray-700"
      >Página {{ currentPage }} de {{ totalPages }}</span
    >
    <button
      (click)="currentPage = currentPage + 1; updatePaginatedExpenses()"
      [disabled]="currentPage === totalPages"
      class="px-2 py-1 text-gray-700 border rounded-full disabled:opacity-50 flex items-center justify-center w-7 h-7"
    >
      →
    </button>
    <button
      (click)="currentPage = totalPages; updatePaginatedExpenses()"
      [disabled]="currentPage === totalPages"
      class="px-2 py-1 border rounded-full disabled:opacity-50 flex items-center justify-center w-8 h-8"
    >
      &#8658;
    </button>
  </div>

  <!-- Selector de elementos por página -->
  <div class="items-per-page flex items-center">
    <label for="itemsPerPage" class="mr-2">Elementos por página:</label>
    <select
      id="itemsPerPage"
      [(ngModel)]="itemsPerPage"
      (change)="currentPage = 1; updatePaginatedExpenses()"
      class="border border-gray-300 rounded-md p-1"
    >
      <option *ngFor="let size of [2, 10, 15, 20]" [value]="size">
        {{ size }}
      </option>
    </select>
  </div>
</div>

<!-- Modal para añadir/editar egresos -->
<div *ngIf="showModal" class="modal-overlay">
  <div class="modal-content modal-h600">
    <h2 class="text-lg font-bold mb-4">
      {{ isEditing ? "Editar Egreso" : "Añadir Nuevo Egreso" }}
    </h2>

    <!-- Formulario -->
    <form (ngSubmit)="saveExpense()" class="space-y-4">
      <div class="modal-input-item">
        <label class="block text-sm font-medium text-gray-700"
          >Fecha de Egreso <span class="text-red-500">*</span></label
        >
        <input
          type="date"
          [(ngModel)]="selectedExpense.payment_date"
          name="payment_date"
          class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          required
        />
      </div>

      <div class="modal-input-item">
        <label class="block text-sm font-medium text-gray-700"
          >Categoría <span class="text-red-500">*</span></label
        >
        <select
          [(ngModel)]="selectedExpense.category"
          (change)="onCategoryChange($event)"
          name="category"
          class="form-select mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          required
        >
          <option value="" disabled selected>Seleccione...</option>
          <option
            *ngFor="let cat of getAllCategories()"
            [value]="cat"
          >
            {{ getCategoryLabel(cat) }}
          </option>

          <option value="NEW_CATEGORY_OPTION" class="font-bold text-blue-600">
            + Nueva categoría
          </option>
        </select>
      </div>
      <div
        *ngIf="categoryJustAdded"
        class="mt-2 text-sm font-semibold text-green-700 bg-green-50 border border-green-200 rounded px-3 py-2 animate-fadeIn"
      >
        Categoría <span class="font-bold">{{ selectedExpense.category }}</span> seleccionada
      </div>
      <div
        *ngIf="isNewCategoryMode"
        class="bg-blue-50 p-4 rounded-md border border-blue-200 space-y-2 mt-2"
      >
        <label class="block text-sm font-medium text-blue-800">
          Nueva Categoría
        </label>

        <div class="flex gap-2">
          <input
            type="text"
            [(ngModel)]="newCategory"
            name="new_category"
            placeholder="Ej: Seguros, Honorarios, Fletes"
            class="form-input w-full text-sm rounded-md"
          />
          <button
            type="button"
            class="btn-primary text-sm px-3"
            (click)="confirmNewCategory()"
          >
            Usar
          </button>
        </div>
      </div>
      <!-- Tipo de Servicio (solo para SERVICES) -->
      <div
        *ngIf="isServiceCategory"
        class="bg-yellow-50 p-4 rounded-md border border-yellow-200 space-y-3 mt-2"
      >
        <h3 class="font-semibold text-yellow-800 text-sm">Tipo de Servicio</h3>

        <!-- Selector -->
        <select
          [(ngModel)]="selectedExpense.service_type"
          name="service_type"
          class="form-select mt-1 block w-full rounded-md border-gray-300 shadow-sm"
        >
          <option value="" disabled>Seleccione tipo de servicio</option>
          <option *ngFor="let s of getServiceTypes()" [value]="s">
            {{ s }}
          </option>
        </select>

        <!-- Crear nuevo -->
        <div class="flex gap-2 mt-2">
          <input
            type="text"
            [(ngModel)]="newServiceType"
            name="new_service_type"
            placeholder="Nuevo tipo de servicio (Ej: Gas)"
            class="form-input w-full text-sm rounded-md"
          />
          <button
            type="button"
            class="btn-primary text-sm px-3"
            (click)="confirmNewServiceType()"
          >
            Usar
          </button>
        </div>
      </div>

      <div
        class="bg-blue-50 p-4 rounded-md border border-blue-200 space-y-3 mt-2"
      >
        <h3 class="font-semibold text-blue-800 text-sm">
          Detalles del Proveedor
        </h3>

        <div>
          <label class="block text-sm font-medium text-gray-700"
            >Proveedor</label
          >
          <select
            [(ngModel)]="selectedExpense.id_provider"
            (change)="onProviderChange($event)"
            name="id_provider"
            class="form-select mt-1 block w-full rounded-md border-gray-300"
          >
            <option value="" disabled>Seleccione un proveedor</option>
            <option value="NEW_PROVIDER_OPTION" class="font-bold text-blue-600">
              + Nuevo Proveedor
            </option>
            <option disabled>----------------</option>
            <option
              *ngFor="let prov of providersList"
              [value]="prov.id_provider"
            >
              {{ prov.company_name || prov.name }} ({{ prov.document_number }})
            </option>
          </select>
        </div>

        <div
          *ngIf="isNewProviderMode"
          class="pl-2 border-l-2 border-blue-400 space-y-2"
        >
          <div>
            <input
              type="text"
              [(ngModel)]="newProviderData.company_name"
              name="new_company"
              placeholder="Nombre Empresa / Razón Social"
              class="form-input w-full text-sm rounded-md"
            />
          </div>
          <div class="flex gap-2">
            <input
              type="text"
              [(ngModel)]="newProviderData.name"
              name="new_name"
              placeholder="Nombre Contacto"
              class="form-input w-1/2 text-sm rounded-md"
            />
            <input
              type="text"
              [(ngModel)]="newProviderData.document_number"
              name="new_doc"
              placeholder="NIT / Cédula"
              class="form-input w-1/2 text-sm rounded-md"
            />
          </div>
          <div>
            <input
              type="text"
              [(ngModel)]="newProviderData.phone_number"
              name="new_phone"
              placeholder="Teléfono"
              class="form-input w-full text-sm rounded-md"
            />
          </div>
        </div>
      </div>

      <div class="modal-input-item">
        <label class="block text-sm font-medium text-gray-700">
          Método de Pago
        </label>
        <select
          [(ngModel)]="selectedExpense.type"
          name="type"
          class="form-select mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          required
        >
          <option value="" disabled>Seleccione un método</option>
          <option value="cash">Efectivo</option>
          <option value="nequi">Nequi</option>
          <option value="bancolombia">Bancolombia</option>
          <option value="davivienda">Davivienda</option>
          <option value="transfer">Transferencia</option>
        </select>
      </div>

      <div class="modal-input-item">
        <label for="description">Anotación</label>
        <textarea
          [(ngModel)]="selectedExpense.description"
          name="description"
          rows="2"
          class="form-textarea mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          required
        ></textarea>
      </div>

      <div class="modal-input-item">
        <label class="block text-sm font-medium text-gray-700">Costo</label>
        <input
          type="number"
          [(ngModel)]="selectedExpense.cost"
          name="cost"
          step="0.01"
          class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          required
        />
      </div>
      <div
        class="bg-gray-50 p-4 rounded-md border border-gray-200 mt-4 space-y-4"
      >
        <h3 class="font-semibold text-gray-800 text-sm">Adjuntos</h3>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Factura / Recibo</label
          >
          <div class="flex items-center gap-2">
            <input
              type="file"
              (change)="onInvoiceFileSelected($event)"
              class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
            />
            <button
              *ngIf="selectedExpense.invoice_file_path"
              type="button"
              (click)="downloadFile(selectedExpense.invoice_file_path)"
              class="text-blue-600 hover:text-blue-800 text-sm font-bold flex items-center gap-1"
              title="Descargar Factura Actual"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M12 9.75v10.5m0 0 4.5-4.5M12 20.25l-4.5-4.5M12 3v9"
                />
              </svg>
              Ver
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Comprobante de Pago</label
          >
          <div class="flex items-center gap-2">
            <input
              type="file"
              (change)="onProofFileSelected($event)"
              class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"
            />
            <button
              *ngIf="selectedExpense.proof_of_payment_path"
              type="button"
              (click)="downloadFile(selectedExpense.proof_of_payment_path)"
              class="text-green-600 hover:text-green-800 text-sm font-bold flex items-center gap-1"
              title="Descargar Comprobante Actual"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M12 9.75v10.5m0 0 4.5-4.5M12 20.25l-4.5-4.5M12 3v9"
                />
              </svg>
              Ver
            </button>
          </div>
        </div>
      </div>
      <div class="bg-gray-50 p-3 rounded border border-gray-200 mt-4">
        <div class="flex gap-4 items-center">
          <span class="text-sm font-bold text-gray-700">Estado de Pago:</span>

          <label class="inline-flex items-center cursor-pointer">
            <input
              type="radio"
              class="form-radio text-green-600"
              name="payment_status"
              value="PAID"
              [(ngModel)]="selectedExpense.payment_status"
              (change)="onStatusChange($event)"
            />
            <span class="ml-2 text-sm">Pagado</span>
          </label>

          <label class="inline-flex items-center cursor-pointer">
            <input
              type="radio"
              class="form-radio text-red-600"
              name="payment_status"
              value="PENDING"
              [(ngModel)]="selectedExpense.payment_status"
              (change)="onStatusChange($event)"
            />
            <span class="ml-2 text-sm">Pendiente</span>
          </label>
        </div>

        <div
          *ngIf="selectedExpense.payment_status === 'PENDING'"
          class="mt-3 animate-fadeIn"
        >
          <label class="block text-sm font-medium text-red-700"
            >Fecha Límite de Pago <span class="text-red-500">*</span></label
          >
          <input
            type="date"
            [(ngModel)]="selectedExpense.payment_due_date"
            name="payment_due_date"
            class="form-input mt-1 block w-full rounded-md border-red-300 focus:ring-red-500"
            required
          />
          <p class="text-xs text-red-500 mt-1 font-semibold">
            Se generará alerta 1 día antes y el mismo día.
          </p>
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-4 border-t mt-4">
        <button
          type="button"
          class="btn-danger px-4 py-2"
          (click)="closeModal()"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="btn-success px-4 py-2"
          [disabled]="isSaving"
        >
           {{ submitButtonText }}
        </button>
      </div>
    </form>
  </div>
</div>
<div *ngIf="showDetailsModal" class="modal-overlay">
  <div class="modal-content bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl modal-h550 overflow-y-auto">
    
    <div class="flex justify-between items-start mb-4 border-b pb-2">
      <h2 class="text-xl font-bold text-gray-800">
        Detalle de Egreso
      </h2>
      <button (click)="closeDetailsModal()" class="text-gray-500 hover:text-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase">Fecha</label>
          <p class="text-gray-900">{{ selectedExpense.payment_date | date : "fullDate" }}</p>
        </div>
        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase">Costo</label>
          <p class="text-xl font-mono font-bold text-gray-900">{{ selectedExpense.cost | currency }}</p>
        </div>
        <div>
           <label class="block text-xs font-bold text-gray-500 uppercase">Categoría</label>
           <span class="inline-block bg-gray-100 rounded px-2 py-1 text-sm font-semibold text-gray-700">
             {{ getCategoryLabel(selectedExpense.category) }}
             <span *ngIf="selectedExpense.service_type"> - {{selectedExpense.service_type}}</span>
           </span>
        </div>
        <div>
           <label class="block text-xs font-bold text-gray-500 uppercase">Método de Pago</label>
           <p class="text-gray-900">{{ selectedExpense.type }}</p>
        </div>
      </div>

      <div *ngIf="selectedExpense.provider_name" class="bg-blue-50 p-3 rounded border border-blue-100">
         <label class="block text-xs font-bold text-blue-500 uppercase">Proveedor</label>
         <p class="text-blue-900 font-medium">{{ selectedExpense.provider_name }}</p>
      </div>

      <div>
        <label class="block text-xs font-bold text-gray-500 uppercase">Anotación / Descripción</label>
        <div class="bg-gray-50 p-3 rounded border border-gray-200 text-gray-800 whitespace-pre-wrap">
          {{ selectedExpense.description }}
        </div>
      </div>

      <div class="flex items-center gap-2 mt-2">
         <label class="block text-xs font-bold text-gray-500 uppercase">Estado:</label>
         <span class="px-2 py-1 text-xs font-bold rounded"
           [ngClass]="{'bg-green-100 text-green-700': selectedExpense.payment_status === 'PAID', 'bg-red-100 text-red-700': selectedExpense.payment_status === 'PENDING'}">
            {{ selectedExpense.payment_status === 'PAID' ? 'PAGADO' : 'PENDIENTE' }}
         </span>
         <span *ngIf="selectedExpense.payment_status === 'PENDING'" class="text-xs text-red-500 font-semibold">
           (Vence: {{ selectedExpense.payment_due_date | date: 'dd/MM/yyyy' }})
         </span>
      </div>

      <div class="border-t pt-4 mt-4">
        <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
             <path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13" />
           </svg>
           Adjuntos
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          
          <div class="border rounded p-3 flex items-center justify-between bg-gray-50">
             <div class="flex items-center gap-2">
               <span class="text-sm font-semibold text-gray-600">Factura / Recibo</span>
             </div>
             <button 
                *ngIf="selectedExpense.invoice_file_path"
                (click)="downloadFile(selectedExpense.invoice_file_path)"
                class="btn-primary text-xs px-3 py-1 flex items-center gap-1"
             >
                Descargar
             </button>
             <span *ngIf="!selectedExpense.invoice_file_path" class="text-xs text-gray-400 italic">No adjuntado</span>
          </div>

          <div class="border rounded p-3 flex items-center justify-between bg-gray-50">
             <div class="flex items-center gap-2">
               <span class="text-sm font-semibold text-gray-600">Comprobante Pago</span>
             </div>
             <button 
                *ngIf="selectedExpense.proof_of_payment_path"
                (click)="downloadFile(selectedExpense.proof_of_payment_path)"
                class="btn-primary text-xs px-3 py-1 flex items-center gap-1"
             >
                Descargar
             </button>
             <span *ngIf="!selectedExpense.proof_of_payment_path" class="text-xs text-gray-400 italic">No adjuntado</span>
          </div>

        </div>
      </div>

    </div>

    <div class="flex justify-end mt-6">
      <button class="btn-primary px-6" (click)="closeDetailsModal()">Cerrar</button>
    </div>
  </div>
</div>